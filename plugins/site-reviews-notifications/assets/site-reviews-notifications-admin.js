!function(){var e,t={377:function(){window.crypto||(window.crypto=window.msCrypto)},257:function(e,t,i){"use strict";i(377);var n=GLSR.addons["site-reviews-notifications"];var o=function(e){return!(_.isNull(e)||_.isUndefined(e)||_.isString(e)&&""===jQuery.trim(e)||_.isArray(e)&&_.isEmpty(e))},r={between:function(e,t,i,r){if(o(e)&&(!jQuery.isNumeric(e)||+e<r[0]||+e>r[1]))return wp.i18n.sprintf(n.messages.between,n.labels[t],r[0],r[1])},criteria:function(e,t,i){var o=(e||"").split("|");if("always"!==o[0]&&1===o.length)return wp.i18n.sprintf(n.messages.criteria,n.labels[t])},number:function(e,t,i){if(o(e)&&!jQuery.isNumeric(e))return wp.i18n.sprintf(n.messages.number,n.labels[t])},required:function(e,t,i){if(!o(e))return wp.i18n.sprintf(n.messages.required,n.labels[t])},unique:function(e,t,i){var r=_.filter(i.collection.where(function(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}({},t,e)),(function(e){return e.cid!==i.cid}));if(o(e)&&r.length)return wp.i18n.sprintf(n.messages.unique,n.labels[t])}};let s=e=>crypto.getRandomValues(new Uint8Array(e)),l=(e,t=21)=>((e,t,i)=>{let n=(2<<Math.log(e.length-1)/Math.LN2)-1,o=-~(1.6*n*t/e.length);return(r=t)=>{let s="";for(;;){let t=i(o),l=o;for(;l--;)if(s+=e[t[l]&n]||"",s.length===r)return s}}})(e,t,s);var a=Backbone.Model.extend({defaults:function(){return{conditions:"always",enabled:!1,heading:"",message:"",recipients:[],schedule:0,subject:"",uid:l("1234567890abcdef",13)()}},errors:{},expanded:!1,toggle:function(e){return this.expanded=_.isBoolean(e)?e:!this.expanded,this},validate:function(e){var t=this;if(this.errors={},_.each(n.validation,(function(i,n){_.each(i,(function(i,o){var s=r[o](e[n],n,t,i);s&&(t.errors[n]=s)}))})),!_.isEmpty(this.errors))return console.error(this.errors),"invalid"}}),c=Backbone.Collection.extend({model:a});var u={classes:{active:"is-active",criteria:"glsr-criteria",error:"glsrn-field-error",expanded:"is-expanded",field:"glsr-metabox-field",highlighted:"is-highlighted",input:"glsr-input",invalid:"is-invalid",mb:"glsr-search-multibox",mb_entries:"glsr-selected-entries",mb_entry:"glsr-multibox-entry",mb_input:"glsr-search-input",mb_remove:"glsr-remove-button",mb_result:"glsr-search-result",mb_results:"glsr-search-results",notifications:"gl-tbody",placeholder:"glsrn-placeholder",preview_active:"preview-active",removing:"is-removing",settings:"gl-settings"},contains:function(e,t){return e.classList.contains(this.classes[t]||t)},encode:function(e){return JSON.stringify(e)},escapeHtml:function(e){return e.replace(/[&<>'"]/g,(function(e){return"&#"+e.charCodeAt(0)+";"}))},selector:function(e){return"."+this.classes[e]||0}};function d(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function h(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var f=Backbone.View.extend({className:"glsr-criteria-condition",template:null,events:{"change select[data-condition=field]":"onChangeField","change select[data-condition=operator]":"onChange","change select[data-condition=value]":"onChange","keyup input[data-condition=value]":"onChange","click .glsr-remove-condition":"onRemove"},initialize:function(){console.info("ui:cr:co:initialize"),this.template=_.template(jQuery("#tmpl-glsrn-criteria-condition").html()),this.listenTo(this.model,"destroy",this.remove)},render:function(){return console.info("ui:cr:co:render"),this.$el.html(this.template(this.data())),this},data:function(){var e=this.model.toJSON(),t=n.criteria.fields,i=_.get(n.criteria.restrictions,e.field,{}),o=_.pick(n.criteria.operators,i.operators||[]),r=_.pick(n.criteria.values,i.values||[]),s=this.model.previous("field"),l=!_.isUndefined(s)&&e.field!==s;return _.isEmpty(o)?l&&(e.operator=""):_.isUndefined(o[e.operator])&&(e.operator=_.keys(o).shift()),_.isEmpty(r)?l&&(e.value=""):_.isUndefined(r[e.value])&&(e.value=_.keys(r).shift()),this.model.set(e,{silent:!0}),function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?d(Object(i),!0).forEach((function(t){h(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):d(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}({fields:t,operators:o,values:r},this.model.toJSON())},onChange:function(e){console.info("ui:cr:co:onChange");var t=e.target.dataset.condition,i=e.target.value;this.model.set(t,i)},onChangeField:function(e){console.info("ui:cr:co:onChangeField"),this.onChange(e),this.render()},onRemove:function(e){console.info("ui:cr:co:onRemove"),e.preventDefault(),this.model.destroy()}}),p=f,g=Backbone.Model.extend({defaults:{field:"",operator:"",value:""}}),m=Backbone.Collection.extend({model:g}),v=Backbone.View.extend({collection:null,criteria:[],key:null,selected:"",template:null,events:{"change .glsr-criteria-option select":"onChange","click .glsr-add-condition":"onAddCondition"},initialize:function(e){console.info("ui:criteria:initialize"),_.extend(this,_.pick(e,"key")),this.collection=new m,this.listenTo(this.collection,"add",this.update),this.listenTo(this.collection,"change",this.update),this.listenTo(this.collection,"remove",this.update),this.template=_.template(jQuery("#tmpl-glsrn-criteria").html())},render:function(){console.info("ui:criteria:render"),this.selected=this.model.get(this.key).split("|").shift()||"always";var e={cid:this.model.cid,selected:this.selected,conditions:n.criteria.conditions,key:this.key};return this.$el.html(this.template(e)),this.addConditions(),"always"===this.selected&&this.$(".glsr-add-condition").hide(),this},addCondition:function(e){if(_.isEmpty(e)){var t=_.keys(n.criteria.fields).shift(),i=_.get(n.criteria.restrictions,t,[]);e={field:t,operator:_.keys(_.pick(n.criteria.operators,i.operators)).shift()}}var o=new g(e),r=new p({model:o});this.$(".glsr-criteria-conditions").append(r.render().el),this.collection.add(o)},addConditions:function(){var e=this,t=this.model.get(this.key).split("|");t.shift(),_.map(t,(function(t){var i=_.object(["field","operator","value"],t.split(":"));e.addCondition(i)})),this.model.trigger("model:validate:reset",this.el)},onAddCondition:function(e){console.info("ui:criteria:onAddCondition"),e.preventDefault(),this.addCondition(),this.model.trigger("model:validate:reset",this.el)},onChange:function(e){console.info("ui:criteria:onChange"),this.selected=e.target.value;var t="always"===this.selected?"hide":"show",i=this.$(".glsr-criteria-conditions");this.$(".glsr-add-condition")[t](),i[t](),"show"===t&&0===i.children().length?this.addCondition():this.model.trigger("model:validate:reset",e.target),this.update()},update:function(e,t,i){console.info("ui:criteria:update");var n=this.$(".glsr-criteria-conditions"),o=[this.selected];this.collection.each((function(e){var t=e.toJSON();o.push(t.field+":"+t.operator+":"+t.value)})),this.model.set(this.key,o.join("|"),{silent:!0}),this.model.trigger("model:change"),n.find(".glsr-remove-condition").prop("disabled",n.children().length<2)}}),b=["Down","Esc","Enter","Up"],y=["Tab"],w=Backbone.View.extend({key:null,options:[],restricted:!1,template:null,templateEntry:null,events:{"focus .glsr-search-input":"onClickInside","input .glsr-search-input":"onSearch","click .glsr-remove-button":"onRemove","click .glsr-search-result":"onSelect","mouseleave .glsr-search-result":"onMouseleave","mouseover .glsr-search-result":"onMouseover"},initialize:function(e){console.info("ui:multibox:initialize"),_.extend(this,_.pick(e,"key","options","restricted")),this.listenTo(this.model,"model:click",this.onClickOutside),this.listenTo(this.model,"model:keydown",this.onKeydown),this.listenTo(this.model,"model:keyup",this.onKeyup),this.template=_.template(jQuery("#tmpl-glsrn-multibox").html()),this.templateEntry=_.template(jQuery("#tmpl-glsrn-multibox-entry").html())},render:function(){console.info("ui:multibox:render"),this.$el.html(this.template({cid:this.model.cid,key:this.key,options:this.options})),this.refresh()},filterEntries:function(){var e=this;console.info("ui:multibox:filterEntries");var t=this.model.get(this.key)||[],i=this.$(u.selector("mb_input")).val();this.$(u.selector("mb_result")).each((function(n,o){var r=e.$(o),s=~t.indexOf(r.data("slug")),l=-1===r.text().toLowerCase().indexOf(i.toLowerCase());r[s||l?"hide":"show"]()}))},hideDropdown:function(){this.removeHighlighted(),this.$(u.selector("mb_results")).removeClass(u.classes.active),this.$(u.selector("mb_input")).val("").blur()},keydownDown:function(e){console.info("ui:multibox:keydownDown"),(u.contains(e.target,"mb_input")||u.contains(e.target,"mb_result"))&&(e.preventDefault(),this.navigateDown())},keydownEnter:function(e){var t=this.$(e.target);if(t.length)if(console.info("ui:multibox:keydownEnter"),t.hasClass(u.classes.mb_remove))this.removeSelected(t);else if(t.hasClass(u.classes.mb_input)){var i=this.$(u.selector("mb_result")+u.selector("highlighted"));if(i.length)this.selectOption(i);else if(!this.restricted&&!_.isEmpty(t.val())){var n=this.model.get(this.key)||[];n.push(t.val()),n=_.uniq(n).sort(),this.model.set(this.key,n,{silent:!0,validate:!0}),this.refresh(),this.model.trigger("model:validate:reset",t),this.$(u.selector("mb_input")).val("").focus()}}},keydownEsc:function(e){console.info("ui:multibox:keydownEsc"),this.removeHighlighted()},keydownUp:function(e){console.info("ui:multibox:keydownUp"),(u.contains(e.target,"mb_input")||u.contains(e.target,"mb_result"))&&(e.preventDefault(),this.navigateUp())},keyupTab:function(e){console.info("ui:multibox:keyupTab"),u.contains(e.target,"mb_input")?this.showDropdown():this.hideDropdown()},navigate:function(e){console.info("ui:multibox:navigate");var t=this.$(u.selector("mb_result")),i=t.filter(u.selector("highlighted"));i.removeClass(u.classes.highlighted);var n=i.index()+e;if(n<0)this.$(u.selector("mb_input")).focus();else{for(;t.eq(n).is(":hidden")&&!(n<0||n>t.length);)n+=e;(n=Math.min(n,t.length-1))<0?(t.removeClass(u.classes.highlighted),this.$(u.selector("mb_input")).focus()):t.eq(n).addClass(u.classes.highlighted)}},navigateDown:function(){console.info("ui:multibox:navigateDown"),this.showDropdown(),this.navigate(1)},navigateUp:function(){console.info("ui:multibox:navigateUp"),this.showDropdown(),this.navigate(-1)},onClickInside:function(e){this.showDropdown()},onClickOutside:function(e){this.$(e.target).length||this.hideDropdown()},onKeydown:function(e){var t,i=e.key.replace(/Arrow|ape/g,"");~b.indexOf(i)&&(e.stopPropagation(),null===(t=this["keydown"+i])||void 0===t||t.call(this,e))},onKeyup:function(e){var t,i=e.key.replace(/Arrow|ape/g,"");~y.indexOf(i)&&(e.stopPropagation(),null===(t=this["keyup"+i])||void 0===t||t.call(this,e))},onMouseleave:function(e){this.$(e.currentTarget).removeClass(u.classes.highlighted)},onMouseover:function(e){this.removeHighlighted(),this.$(e.currentTarget).addClass(u.classes.highlighted)},onRemove:function(e){this.removeSelected(jQuery(e.currentTarget))},onSearch:function(e){var t=this;_.debounce((function(){t.removeHighlighted(),t.refresh()}),100)()},onSelect:function(e){this.selectOption(jQuery(e.currentTarget))},refresh:function(){console.info("ui:multibox:refresh"),this.renderEntries(),this.filterEntries()},removeHighlighted:function(){this.$(u.selector("mb_result")).removeClass(u.classes.highlighted)},removeSelected:function(e){var t=this;console.info("ui:multibox:removeSelected");var i=e.data("slug");if(i){var n=_.without(this.model.get(this.key)||[],i);this.model.set(this.key,n,{silent:!0}),this.model.trigger("model:change"),e.closest(u.selector("mb_entry")).css({backgroundColor:"#F1ADAD"}).fadeOut(350,(function(){t.removeHighlighted(),t.refresh(),t.$(u.selector("mb_input")).focus()}))}},renderEntries:function(){var e=this;console.info("ui:multibox:renderEntries");var t=this.model.get(this.key)||[],i=this.$(u.selector("mb_entries"));i.html(""),_.each(t,(function(t){var n=_.findWhere(e.options,{slug:t});i.append(e.templateEntry(n||{name:t,slug:t}))}))},selectOption:function(e){console.info("ui:multibox:selectOption");var t=e.data("slug");if(t){var i=this.model.get(this.key)||[];i.push(t),this.restricted&&(i=_.pluck(_.filter(this.options,(function(e){return~i.indexOf(e.slug)})),"slug")),i=_.uniq(i).sort(),this.model.set(this.key,i,{silent:!0,validate:!0}),this.refresh(),this.model.trigger("model:validate:reset",e),this.$(u.selector("mb_input")).focus()}},showDropdown:function(){var e=this.$(u.selector("mb_results"));e.length&&(e.hasClass(u.classes.active)||(this.removeHighlighted(),this.refresh(),e.addClass(u.classes.active)))}}),x={grad:.9,turn:360,rad:360/(2*Math.PI)},k=function(e){return"string"==typeof e?e.length>0:"number"==typeof e},C=function(e,t,i){return void 0===t&&(t=0),void 0===i&&(i=Math.pow(10,t)),Math.round(i*e)/i+0},$=function(e,t,i){return void 0===t&&(t=0),void 0===i&&(i=1),e>i?i:e>t?e:t},O=function(e){return(e=isFinite(e)?e%360:0)>0?e:e+360},T=function(e){return{r:$(e.r,0,255),g:$(e.g,0,255),b:$(e.b,0,255),a:$(e.a)}},j=function(e){return{r:C(e.r),g:C(e.g),b:C(e.b),a:C(e.a,3)}},E=/^#([0-9a-f]{3,8})$/i,D=function(e){var t=e.toString(16);return t.length<2?"0"+t:t},N=function(e){var t=e.r,i=e.g,n=e.b,o=e.a,r=Math.max(t,i,n),s=r-Math.min(t,i,n),l=s?r===t?(i-n)/s:r===i?2+(n-t)/s:4+(t-i)/s:0;return{h:60*(l<0?l+6:l),s:r?s/r*100:0,v:r/255*100,a:o}},M=function(e){var t=e.h,i=e.s,n=e.v,o=e.a;t=t/360*6,i/=100,n/=100;var r=Math.floor(t),s=n*(1-i),l=n*(1-(t-r)*i),a=n*(1-(1-t+r)*i),c=r%6;return{r:255*[n,l,s,s,a,n][c],g:255*[a,n,n,l,s,s][c],b:255*[s,s,a,n,n,l][c],a:o}},S=function(e){return{h:O(e.h),s:$(e.s,0,100),l:$(e.l,0,100),a:$(e.a)}},z=function(e){return{h:C(e.h),s:C(e.s),l:C(e.l),a:C(e.a,3)}},A=function(e){return M((i=(t=e).s,{h:t.h,s:(i*=((n=t.l)<50?n:100-n)/100)>0?2*i/(n+i)*100:0,v:n+i,a:t.a}));var t,i,n},P=function(e){return{h:(t=N(e)).h,s:(o=(200-(i=t.s))*(n=t.v)/100)>0&&o<200?i*n/100/(o<=100?o:200-o)*100:0,l:o/2,a:t.a};var t,i,n,o},V=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,H=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,R=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Q=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,I={string:[[function(e){var t=E.exec(e);return t?(e=t[1]).length<=4?{r:parseInt(e[0]+e[0],16),g:parseInt(e[1]+e[1],16),b:parseInt(e[2]+e[2],16),a:4===e.length?C(parseInt(e[3]+e[3],16)/255,2):1}:6===e.length||8===e.length?{r:parseInt(e.substr(0,2),16),g:parseInt(e.substr(2,2),16),b:parseInt(e.substr(4,2),16),a:8===e.length?C(parseInt(e.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(e){var t=R.exec(e)||Q.exec(e);return t?t[2]!==t[4]||t[4]!==t[6]?null:T({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:void 0===t[7]?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(e){var t=V.exec(e)||H.exec(e);if(!t)return null;var i,n,o=S({h:(i=t[1],n=t[2],void 0===n&&(n="deg"),Number(i)*(x[n]||1)),s:Number(t[3]),l:Number(t[4]),a:void 0===t[5]?1:Number(t[5])/(t[6]?100:1)});return A(o)},"hsl"]],object:[[function(e){var t=e.r,i=e.g,n=e.b,o=e.a,r=void 0===o?1:o;return k(t)&&k(i)&&k(n)?T({r:Number(t),g:Number(i),b:Number(n),a:Number(r)}):null},"rgb"],[function(e){var t=e.h,i=e.s,n=e.l,o=e.a,r=void 0===o?1:o;if(!k(t)||!k(i)||!k(n))return null;var s=S({h:Number(t),s:Number(i),l:Number(n),a:Number(r)});return A(s)},"hsl"],[function(e){var t=e.h,i=e.s,n=e.v,o=e.a,r=void 0===o?1:o;if(!k(t)||!k(i)||!k(n))return null;var s=function(e){return{h:O(e.h),s:$(e.s,0,100),v:$(e.v,0,100),a:$(e.a)}}({h:Number(t),s:Number(i),v:Number(n),a:Number(r)});return M(s)},"hsv"]]},U=function(e,t){for(var i=0;i<t.length;i++){var n=t[i][0](e);if(n)return[n,t[i][1]]}return[null,void 0]},L=function(e){return"string"==typeof e?U(e.trim(),I.string):"object"==typeof e&&null!==e?U(e,I.object):[null,void 0]},q=function(e,t){var i=P(e);return{h:i.h,s:$(i.s+100*t,0,100),l:i.l,a:i.a}},B=function(e){return(299*e.r+587*e.g+114*e.b)/1e3/255},F=function(e,t){var i=P(e);return{h:i.h,s:i.s,l:$(i.l+100*t,0,100),a:i.a}},K=function(){function e(e){this.parsed=L(e)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return e.prototype.isValid=function(){return null!==this.parsed},e.prototype.brightness=function(){return C(B(this.rgba),2)},e.prototype.isDark=function(){return B(this.rgba)<.5},e.prototype.isLight=function(){return B(this.rgba)>=.5},e.prototype.toHex=function(){return t=(e=j(this.rgba)).r,i=e.g,n=e.b,r=(o=e.a)<1?D(C(255*o)):"","#"+D(t)+D(i)+D(n)+r;var e,t,i,n,o,r},e.prototype.toRgb=function(){return j(this.rgba)},e.prototype.toRgbString=function(){return t=(e=j(this.rgba)).r,i=e.g,n=e.b,(o=e.a)<1?"rgba("+t+", "+i+", "+n+", "+o+")":"rgb("+t+", "+i+", "+n+")";var e,t,i,n,o},e.prototype.toHsl=function(){return z(P(this.rgba))},e.prototype.toHslString=function(){return t=(e=z(P(this.rgba))).h,i=e.s,n=e.l,(o=e.a)<1?"hsla("+t+", "+i+"%, "+n+"%, "+o+")":"hsl("+t+", "+i+"%, "+n+"%)";var e,t,i,n,o},e.prototype.toHsv=function(){return e=N(this.rgba),{h:C(e.h),s:C(e.s),v:C(e.v),a:C(e.a,3)};var e},e.prototype.invert=function(){return J({r:255-(e=this.rgba).r,g:255-e.g,b:255-e.b,a:e.a});var e},e.prototype.saturate=function(e){return void 0===e&&(e=.1),J(q(this.rgba,e))},e.prototype.desaturate=function(e){return void 0===e&&(e=.1),J(q(this.rgba,-e))},e.prototype.grayscale=function(){return J(q(this.rgba,-1))},e.prototype.lighten=function(e){return void 0===e&&(e=.1),J(F(this.rgba,e))},e.prototype.darken=function(e){return void 0===e&&(e=.1),J(F(this.rgba,-e))},e.prototype.rotate=function(e){return void 0===e&&(e=15),this.hue(this.hue()+e)},e.prototype.alpha=function(e){return"number"==typeof e?J({r:(t=this.rgba).r,g:t.g,b:t.b,a:e}):C(this.rgba.a,3);var t},e.prototype.hue=function(e){var t=P(this.rgba);return"number"==typeof e?J({h:e,s:t.s,l:t.l,a:t.a}):C(t.h)},e.prototype.isEqual=function(e){return this.toHex()===J(e).toHex()},e}(),J=function(e){return e instanceof K?e:new K(e)},G=[],X=function(e,t,i){return void 0===t&&(t=0),void 0===i&&(i=1),e>i?i:e>t?e:t},W=function(e){var t=e/255;return t<.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)},Y=function(e){return 255*(e>.0031308?1.055*Math.pow(e,1/2.4)-.055:12.92*e)},Z=96.422,ee=82.521,te=216/24389,ie=24389/27,ne=function(e){var t=function(e){var t=W(e.r),i=W(e.g),n=W(e.b);return function(e){return{x:X(e.x,0,Z),y:X(e.y,0,100),z:X(e.z,0,ee),a:X(e.a)}}(function(e){return{x:1.0478112*e.x+.0228866*e.y+-.050127*e.z,y:.0295424*e.x+.9904844*e.y+-.0170491*e.z,z:-.0092345*e.x+.0150436*e.y+.7521316*e.z,a:e.a}}({x:100*(.4124564*t+.3575761*i+.1804375*n),y:100*(.2126729*t+.7151522*i+.072175*n),z:100*(.0193339*t+.119192*i+.9503041*n),a:e.a}))}(e),i=t.x/Z,n=t.y/100,o=t.z/ee;return i=i>te?Math.cbrt(i):(ie*i+16)/116,{l:116*(n=n>te?Math.cbrt(n):(ie*n+16)/116)-16,a:500*(i-n),b:200*(n-(o=o>te?Math.cbrt(o):(ie*o+16)/116)),alpha:t.a}},oe=function(e,t,i){var n,o=ne(e),r=ne(t);return function(e){var t=(e.l+16)/116,i=e.a/500+t,n=t-e.b/200;return function(e){var t,i,n=.9555766*(t=e).x+-.0230393*t.y+.0631636*t.z,o=-.0282895*t.x+1.0099416*t.y+.0210077*t.z,r=.0122982*t.x+-.020483*t.y+1.3299098*t.z;return i={r:Y(.032404542*n-.015371385*o-.004985314*r),g:Y(-.00969266*n+.018760108*o+41556e-8*r),b:Y(556434e-9*n-.002040259*o+.010572252*r),a:e.a},{r:X(i.r,0,255),g:X(i.g,0,255),b:X(i.b,0,255),a:X(i.a)}}({x:(Math.pow(i,3)>te?Math.pow(i,3):(116*i-16)/ie)*Z,y:100*(e.l>8?Math.pow((e.l+16)/116,3):e.l/ie),z:(Math.pow(n,3)>te?Math.pow(n,3):(116*n-16)/ie)*ee,a:e.alpha})}({l:X((n={l:o.l*(1-i)+r.l*i,a:o.a*(1-i)+r.a*i,b:o.b*(1-i)+r.b*i,alpha:o.alpha*(1-i)+r.alpha*i}).l,0,400),a:n.a,b:n.b,alpha:X(n.alpha)})};!function(e){e.forEach((function(e){G.indexOf(e)<0&&(e(K,I),G.push(e))}))}([function(e){function t(e,t,i){void 0===i&&(i=5);for(var n=[],o=1/(i-1),r=0;r<=i-1;r++)n.push(e.mix(t,o*r));return n}e.prototype.mix=function(t,i){void 0===i&&(i=.5);var n=t instanceof e?t:new e(t),o=oe(this.toRgb(),n.toRgb(),i);return new e(o)},e.prototype.tints=function(e){return t(this,"#fff",e)},e.prototype.shades=function(e){return t(this,"#000",e)},e.prototype.tones=function(e){return t(this,"#808080",e)}}]);var re=Backbone.View.extend({className:"mce-preview",main:null,model:null,template:null,initialize:function(e){console.info("ui:preview:initialize"),_.extend(this,_.pick(e,"main")),this.template=_.template(jQuery("#tmpl-glsrn-preview").html()),this.listenTo(this.main,"preview:render",this.render),this.listenTo(this.model,"model:change",this.render)},render:function(){var e=this;console.info("ui:preview:render");var t="",i=this.main.settings.footer_text,n=this.model.get("heading"),o=this.model.get("message"),r=this.main.settings.header_image;return this.testImage(r).then((function(s){!0===s&&(t=jQuery("<img>").attr({src:r})[0].outerHTML),e.$el.html(e.template({footer:i,heading:n,image:t,message:o})),_.isEmpty(t)&&e.$(".email-top").hide(),_.isEmpty(n)&&e.$(".email-body_header").hide(),_.isEmpty(i)&&e.$(".email-body_footer").hide(),e.$el.css(e.getColorVariables())})),this},getColorVariables:function(){var e=this.main.settings,t={};_.each(e,(function(e,i){/color$/.test(i)&&(t["--email_"+i]=e)}));var i=J(e.background_color);if(i.isValid()){var n=i.isLight()?i.mix("#000",.25):i.mix("#fff",.75);t["--email_footer_text_color"]=n.toHex()}var o=J(e.brand_color);if(o.isValid()){var r=o.isLight()?o.mix("#000",.85):o.mix("#fff",.85);t["--email_header_text_color"]=r.toHex()}return t},testImage:function(e){return new Promise((function(t){var i=new Image;i.src=e,i.onload=function(){return t(!0)},i.onerror=function(){return t(!1)}}))}}),se=Backbone.View.extend({className:"gl-tr",criteria:["conditions"],editor:null,main:null,multibox:["recipients"],template:null,tinymce:null,tippy:[],templates:{subject:"#tmpl-glsrn-field-subject",heading:"#tmpl-glsrn-field-heading",message:"#tmpl-glsrn-field-message",recipients:"#tmpl-glsrn-field-recipients",conditions:"#tmpl-glsrn-field-conditions",schedule:"#tmpl-glsrn-field-schedule",enabled:"#tmpl-glsrn-field-enabled"},events:{"change input[type=checkbox]":"onChange","change select":"onChange","keyup input":"onChange","keyup textarea":"onChange","click button.delete":"onRemove","click button.save":"onSave","click button.test":"onTest","click a.toggle-field":"onToggle",click:"onViewClick",keydown:"onViewKeydown",keyup:"onViewKeyup"},initialize:function(e){console.info("ui:notification:initialize"),_.extend(this,_.pick(e,"main")),this.template=_.template(jQuery("#tmpl-glsrn-notification").html()),this.listenTo(this,"init:editor",this.initEditor),this.listenTo(this,"init:tippy",this.initTippy),this.listenTo(this.model,"change",this.refresh),this.listenTo(this.model,"destroy",this.remove),this.listenTo(this.model,"model:expand",this.expand),this.listenTo(this.model,"model:collapse",this.collapse),this.listenTo(this.model,"model:validate",this.validate),this.listenTo(this.model,"model:validate:reset",this.resetValidation)},render:function(){var e=this;console.info("ui:notification:render");var t=this.prepareAttributes();this.$el.html(this.template(t));var i=this.$(u.selector("settings"));return _.each(this.templates,(function(n,o){var r=_.template(jQuery(n).html());i.append(r(t)),-1!==_.indexOf(e.criteria,o)&&e.loadCriteria(o),-1!==_.indexOf(e.multibox,o)&&e.loadMultibox(o)})),i.append(_.template(jQuery("#tmpl-glsrn-field-actions").html())),this},collapse:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.model.expanded)return console.info("ui:notification:collapse"),this.model.toggle(!1),this.$(u.selector("settings")).slideUp(100,"linear").promise().then((function(){e.$el.removeClass(u.classes.expanded),t&&e.validate()}))},collapseAll:function(){console.info("ui:notification:collapseAll"),this.main.collection.each((function(e){return e.trigger("model:collapse")}))},expand:function(){if(!this.model.expanded)return console.info("ui:notification:expand"),this.model.toggle(!0),this.$el.addClass(u.classes.expanded),this.$(u.selector("settings")).slideDown(100,"linear").promise()},initEditor:function(){var e=this;console.info("ui:notification:initEditor");var t=this.$("textarea.wp-editor-area");this.tinymce=t.attr("id"),wp.editor.initialize(this.tinymce,{quicktags:{buttons:"strong,em,link,ul,ol,li"},tinymce:{init_instance_callback:function(i){e.initPreview(),i.execCommand("wpAutoResizeOn"),i.on("Paste Change input Undo Redo",_.debounce(e.onEditorChange.bind(e,i,t),250)),i.$(document).on("click",e.onPreview.bind(e))},block_formats:"Paragraph=p;Header 2=h2;Header 3=h3;Header 4=h4",paste_retain_style_properties:"",paste_word_valid_elements:"-strong/b,-em/i,-u,-p,-ol,-ul,-li,-h2,-h3,-h4,-a[href|name],sub,sup,strike,del",toolbar1:"formatselect bold italic forecolor bullist numlist link removeformat"}})},initPreview:function(){var e=this.$el.find(".wp-editor-tools"),t=jQuery("<button>").attr({class:"wp-switch-to-preview switch-preview",type:"button"}),i=new re({main:this.main,model:this.model});e.find(".wp-editor-tabs").append(t.text(window.tinymce.translate("Preview"))),e.find(".wp-editor-container").append(i.render().el)},initTippy:function(){console.info("ui:notification:initTippy"),this.tippy=GLSR.Tippy.tippy(this.el.querySelectorAll("[data-tippy-content]"),{appendTo:function(){return document.body},delay:[200,null],offset:[-50,10],placement:"top-start"})},loadCriteria:function(e){console.info("ui:notification:loadCriteria");var t=this.$(u.selector("criteria"));new v({el:t,key:e,model:this.model}).render()},loadMultibox:function(e){console.info("ui:notification:loadMultibox");var t=this.$(u.selector("mb")),i=_.map(n.recipients,(function(e,t){return{name:e,slug:t}}));new w({el:t,options:i,key:e,model:this.model}).render()},onChange:function(e){if(!~["ArrowDown","ArrowUp","Tab"].indexOf(e.key)){console.info("ui:notification:onChange");var t=e.currentTarget,i=t.dataset.field;if(!_.isEmpty(i)){var n=~["checkbox","radio"].indexOf(t.type)?t.checked:t.value;this.model.trigger("model:validate:reset",t),this.model.set(i,n,{silent:!0}),this.model.trigger("model:change")}}},onEditorChange:function(e,t){var i=e.getContent();i!==e._lastChange&&(e._lastChange=i,this.model.trigger("model:validate:reset",t),this.model.set("message",i,{silent:!0}),this.model.trigger("model:change"))},onPreview:function(e){var t=this.$(e.target),i=t.hasClass("wp-switch-to-preview");if(t.hasClass("wp-switch-editor")||i){var n=this.$(".wp-editor-wrap");if(i){var o=tinymce.get(this.tinymce);o&&o.isHidden()&&window.QTags.closeAllTags(this.tinymce),n.addClass(u.classes.preview_active)}else n.removeClass(u.classes.preview_active)}},onRemove:function(e){var t=this;console.info("ui:notification:onRemove"),e.preventDefault(),window.confirm(wp.i18n._x("Are you sure you want to delete this notification?","admin-text","site-reviews-notifications"))&&this.$el.addClass(u.classes.removing).fadeOut(350,(function(){t.tearDown(),t.model.destroy()}))},onSave:function(e){var t=this;if(console.info("ui:notification:onSave"),e.preventDefault(),this.validate()){var i=this.model.get("enabled")?"addClass":"removeClass";this.$el[i](u.classes.active);var n=this.collapse(!1);n&&n.done((function(){return t.model.trigger("change")}))}},onTest:function(e){e.preventDefault(),e.currentTarget.classList.add("is-busy"),this.validate(),e.currentTarget.classList.remove("is-busy")},onToggle:function(e){var t=this;console.info("ui:notification:onToggle"),e.preventDefault(),this.model.toggle(),this.$(u.selector("settings")).slideToggle(100,"linear").promise().done((function(){tinymce.get(t.tinymce).execCommand("wpAutoResize")})),this.validate()},onViewClick:function(e){this.model.trigger("model:click",e)},onViewKeydown:function(e){"Enter"===e.key&&"TEXTAREA"!==e.target.nodeName&&e.preventDefault(),this.model.trigger("model:keydown",e)},onViewKeyup:function(e){this.model.trigger("model:keyup",e)},refresh:function(){console.info("ui:notification:refresh"),this.tearDown(),this.render(),this.trigger("init:tippy"),this.trigger("init:editor")},prepareAttributes:function(){var e,t=this.model.toJSON();if(t.addon=n,t.cid=this.model.cid,t.recipients.length>1)t.selected_recipients=wp.i18n._x("Multiple Recipients","admin-text","site-reviews-notifications");else{var i,o=(null===(i=t.recipients)||void 0===i?void 0:i[0])||wp.i18n._x("None","admin-text","site-reviews-notifications");t.selected_recipients=_.get(n.recipients,o,o)}return t.selected_schedule=null===(e=n.schedule)||void 0===e?void 0:e[t.schedule],t},resetValidation:function(e){console.info("ui:notification:resetValidation");var t=this.$(e).closest(u.selector("field"));t.find(u.selector("invalid")).removeClass(u.classes.invalid),t.find(u.selector("error")).remove()},tearDown:function(){console.info("ui:notification:tearDown"),_.each(this.tippy,(function(e){return e.destroy()})),wp.editor.remove(this.tinymce)},validate:function(){var e=this;return console.info("ui:notification:validate"),this.model.isValid()?(this.$el.removeClass(u.classes.invalid),!0):(this.$el.addClass(u.classes.invalid),_.each(this.model.errors,(function(t,i){var n=e.$("[data-field="+i+"]");e.model.trigger("model:validate:reset",n),n.addClass(u.classes.invalid).closest(u.selector("input")).append(_.template(jQuery("#tmpl-glsrn-field-error").html())({error:t}))})),!1)}}),le=se,ae=Backbone.View.extend({el:"#glsrn",collection:null,data:[],settings:{background_color:"",body_background_color:"",body_text_color:"",brand_color:"",footer_text:"",header_image:""},events:{"click button.add-notification":"create"},initialize:function(e){this.el&&(console.info("ui:main:initialize"),_.extend(this,_.pick(e,"addon")),this.data=n.data,this.collection=new c,this.collection.add(this.data),this.render(),this.listenTo(this.collection,"add",this.insert),this.listenTo(this.collection,"all",_.debounce(this.refresh,50)),this.monitorSettings())},render:function(){return console.info("ui:main:render"),this.$(u.selector("notifications")).html(""),this.collection.length&&this.collection.each(this.insert,this),this.refresh(),this},create:function(e){console.info("ui:main:create"),e.preventDefault();var t=new a;this.collection.each((function(e){return e.trigger("model:collapse")})),this.collection.add(t),t.trigger("model:expand")},insert:function(e){console.info("ui:main:insert");var t=new le({main:this,model:e});this.$(u.selector("notifications")).append(t.render().el),this.$(u.selector("placeholder")).remove(),t.trigger("init:tippy"),t.trigger("init:editor")},insertFallback:function(){if(!this.collection.length){console.info("ui:main:insertFallback");var e=_.template(jQuery("#tmpl-glsrn-notification-empty").html());this.$(u.selector("notifications")).html(e())}},monitorSettings:function(){var e=this;_.each(_.keys(this.settings),(function(t){var i=jQuery('[data-name="'+t+'"]'),n=i[0].nodeName;e.settings[t]=i.val(),"INPUT"===n&&i.on("change",_.debounce((function(i){e.settings[t]=i.target.value,e.trigger("preview:render")}),100)),"TEXTAREA"===n&&i.on("keyup",_.debounce((function(i){e.settings[t]=i.target.value,e.trigger("preview:render")}),100))}))},refresh:function(e){if(!~["model:click","model:keydown","model:keyup"].indexOf(e)&&"invalid"!==e){console.info("ui:main:refresh["+e+"]");var t=[];this.collection.each((function(e){e.isValid({silent:!0})&&t.push(e.toJSON())})),this.insertFallback(),this.$el.find("#glsrn-data").val(u.encode(t)),this.data=t}}});jQuery((function(e){return n.ui=new ae}))},583:function(){}},i={};function n(e){var o=i[e];if(void 0!==o)return o.exports;var r=i[e]={exports:{}};return t[e](r,r.exports,n),r.exports}n.m=t,e=[],n.O=function(t,i,o,r){if(!i){var s=1/0;for(u=0;u<e.length;u++){i=e[u][0],o=e[u][1],r=e[u][2];for(var l=!0,a=0;a<i.length;a++)(!1&r||s>=r)&&Object.keys(n.O).every((function(e){return n.O[e](i[a])}))?i.splice(a--,1):(l=!1,r<s&&(s=r));if(l){e.splice(u--,1);var c=o();void 0!==c&&(t=c)}}return t}r=r||0;for(var u=e.length;u>0&&e[u-1][2]>r;u--)e[u]=e[u-1];e[u]=[i,o,r]},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e={859:0,893:0};n.O.j=function(t){return 0===e[t]};var t=function(t,i){var o,r,s=i[0],l=i[1],a=i[2],c=0;if(s.some((function(t){return 0!==e[t]}))){for(o in l)n.o(l,o)&&(n.m[o]=l[o]);if(a)var u=a(n)}for(t&&t(i);c<s.length;c++)r=s[c],n.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return n.O(u)},i=self.webpackChunk=self.webpackChunk||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))}(),n.O(void 0,[893],(function(){return n(257)}));var o=n.O(void 0,[893],(function(){return n(583)}));o=n.O(o)}();