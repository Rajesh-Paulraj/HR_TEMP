/*! For license information please see site-reviews-themes-admin.js.LICENSE.txt */
!function(){"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function i(e,i){if(e){if("string"==typeof e)return t(e,i);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?t(e,i):void 0}}function n(e){return function(e){if(Array.isArray(e))return t(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||i(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var n,o,r=[],l=!0,a=!1;try{for(i=i.call(e);!(l=(n=i.next()).done)&&(r.push(n.value),!t||r.length!==t);l=!0);}catch(e){a=!0,o=e}finally{try{l||null==i.return||i.return()}finally{if(a)throw o}}return r}}(e,t)||i(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var r={align:{center:"gl-items-center",end:"gl-items-end",start:"gl-items-start",stretch:"gl-items-stretch"},direction:{col:"gl-flex-col",row:"gl-flex-row"},flex:{none:"gl-flex-none",grow:"gl-flex-1",shrink:"gl-flex-0"},is_bold:"gl-bold",is_hidden:"gl-hidden",is_italic:"gl-italic",is_uppercase:"gl-uppercase",text:{large:"gl-text-large",normal:"gl-text-normal",small:"gl-text-small"},wrap:{false:"",true:"gl-flex-wrap"}},l="site-reviews-themes",a=function(e,t){var i=_.property(e)(r);return t&&_.isObject(i)?_.property(t)(i)||"":_.isObject(i)?_.values(i).join(" "):i||""},s=function(e,t){return i={},n=GLSR.nameprefix,o=jQuery.extend({_action:e,_nonce:GLSR.nonce[e],formid:jQuery("#form_ID").val(),postid:jQuery("#post_ID").val()},t),n in i?Object.defineProperty(i,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[n]=o,i;var i,n,o},d=function(e,t){var i=o(t.split("|"),2),n=i[0],r=i[1],l=e;return"chars"===r?l=e.split("").reduce((function(e,t,i){return i<n?e+t:e})):"words"===r&&(l=e.split(" ").reduce((function(e,t,i){return i<n?e+" "+t:e}))),e!==l&&(l=l.replace(/[\W]+$/g,"")),l},c=function e(){for(var t=function(e){return e+""=="[object Object]"},i=arguments.length,o=new Array(i),r=0;r<i;r++)o[r]=arguments[r];return o.reduce((function(i,o){return Object.keys(o).forEach((function(r){var l=i[r],a=o[r];Array.isArray(l)&&Array.isArray(a)?i[r]=l.concat.apply(l,n(a)):t(l)&&t(a)?i[r]=e(l,a):i[r]=a})),i}),{})};function u(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.maxslides,i=void 0===t?6:t,n=e.minwidth,o=void 0===n?320:n;if(this.state.is(Splide.STATES.IDLE)){var r=Math.floor(this.Components.Layout.listSize()/o),l=Math.min(r,i||6);this.options={perPage:l}}}function h(e){return new Swiper(c({breakpoints:{},breakpointsBase:"container",el:".gl-swiper",grabCursor:!0,init:!1,loop:!1,noSwipingSelector:"a",on:{beforeInit:function(){this.params=Object.assign(this.params,JSON.parse(this.el.getAttribute("data-options"))||{})}},pagination:{bulletActiveClass:"is-active",bulletClass:"gl-swiper-bullet",bulletElement:"button",clickable:!0,clickableClass:"gl-swiper-clickable",el:".gl-swiper-pagination"},slideActiveClass:"is-active",slideBlankClass:"gl-slide-invisible-blank",slideClass:"gl-slide",slideNextClass:"gl-slide-next",slidePrevClass:"gl-slide-prev",slidesPerView:1,spaceBetween:16,wrapperClass:"gl-swiper-wrapper"},e||{}))}function p(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.maxslides,i=void 0===t?6:t,n=e.minwidth,o=void 0===n?320:n,r={},l=1;l<=i;l++)r[o*l]={slidesPerView:l};return r}var g=function(e){var t=e.split("|");return!(5!==t.length||_.isNaN(+t[0])||_.isNaN(+t[1])||_.isNaN(+t[2])||_.isNaN(+t[3]))&&t},f=function(e){var t=e.split("|");return!(6!==t.length||_.isNaN(+t[0])||_.isNaN(+t[1])||_.isNaN(+t[2])||_.isNaN(+t[3])||!~["%","px","em","rem"].indexOf(t[4])||!~[0,1].indexOf(+t[5]))&&t},m=function(e){var t=e.split("|");return!(7!==t.length||!~[0,1].indexOf(+t[6]))&&t},v=function(e){var t=e.split("|");return!(4!==t.length||_.isNaN(+t[0])||_.isNaN(+t[1])||!~["ch","em","ex","pt","px","rem"].indexOf(t[2]))&&t},b=Backbone.View.extend({group:null,metabox:null,tagName:"li",template:null,events:{"click button":"onClick"},initialize:function(e){_.extend(this,_.pick(e,"group","metabox")),this.template=_.template(jQuery("#tmpl-glsrt-nav-item").html()),this.listenTo(this.metabox,"toggle:group",this.toggle)},onClick:function(e){e.preventDefault(),e.currentTarget.blur(),this.metabox.trigger("toggle:group",this.group)},render:function(){return this.$el.html(this.template({group:this.group,label:this.metabox.data[this.group].label})),this},toggle:function(e){this.$el.find("button")[e===this.group?"addClass":"removeClass"]("is-active")}}),w=Backbone.View.extend({el:null,template:null,metabox:null,preinitialize:function(e){_.extend(this,_.pick(e,"metabox")),this.el=this.metabox.el.querySelector(".edit-post-sidebar"),this.template=_.template(jQuery("#tmpl-glsrt-nav").html())},render:function(){var e=this;this.$el.html(this.template());var t=this.$el.find("ul");return _.each(this.metabox.data,(function(i,n){var o=new b({group:n,metabox:e.metabox});t.append(o.render().el)})),this.metabox.trigger("toggle:group",_.first(_.keys(this.metabox.data))),this}}),y=Backbone.Model.extend({defaults:{after:"",default:"",depends_on:{},group:"",hidden:!0,label:"",name:"",options:{},section:"",tooltip:"",tooltips:[],value:""},hasLinkedValues:!1,initialize:function(){var e,t;"boxshadow"===this.get("type")?!1===g(this.get("value"))&&this.set("value",this.get("default"),{silent:!0}):"dimensions"===this.get("type")?(!1===f(this.get("value"))&&this.set("value",this.get("default"),{silent:!0}),this.setHasLinkedValues(this.get("value"))):"excerpt"===this.get("type")?!1===(e=this.get("value"),!(2!==(t=e.split("|")).length||_.isNaN(+t[0])||!~["chars","words"].indexOf(t[1]))&&t)&&this.set("value",this.get("default"),{silent:!0}):"ratingcolors"===this.get("type")?(!1===m(this.get("value"))&&this.set("value",this.get("default"),{silent:!0}),this.setHasLinkedValues(this.get("value"))):"typography"===this.get("type")&&!1===v(this.get("value"))&&this.set("value",this.get("default"),{silent:!0})},setHasLinkedValues:function(e){this.hasLinkedValues=!!+_.last(e.split("|"))},validate:function(e){this.setHasLinkedValues(e.value)}}),x=Backbone.Collection.extend({model:y}),S=Backbone.View.extend({className:"glsr-metabox-field",events:{"input input":"onChange",'input input[type="range"]':"onChange","change input":"onChange","change:colorpicker input":"onChange","change select":"onSelect","focus select":"storeSelection","click .glsrt-dimensions > button":"onLink","click .glsrt-ratingcolors > button":"onLink"},isBusy:!1,selected:"",template:null,templates:{boxshadow:"#tmpl-glsrt-input-boxshadow",colorpicker:"#tmpl-glsrt-input-colorpicker",dimensions:"#tmpl-glsrt-input-dimensions",excerpt:"#tmpl-glsrt-input-excerpt",form:"#tmpl-glsrt-select-form",number:"#tmpl-glsrt-input-number",range:"#tmpl-glsrt-input-range",ratingcolors:"#tmpl-glsrt-input-ratingcolors",select:"#tmpl-glsrt-select",text:"#tmpl-glsrt-input-text",typography:"#tmpl-glsrt-input-typography"},initialize:function(){var e=this;this.template=_.template(jQuery("#tmpl-glsrt-setting").html()),this.listenTo(this.model,"model:hide",(function(){return e.$el.addClass("glsr-hidden")})),this.listenTo(this.model,"model:show",(function(){return e.$el.removeClass("glsr-hidden")})),this.listenTo(this.model,"model:refresh",this.refresh)},onChange:function(e){this.isBusy||this.updateModel(e.currentTarget)},onLink:function(e){this.model.hasLinkedValues=!this.model.hasLinkedValues,this.model.set("value",this.value(e.currentTarget),{validate:!0}),jQuery(e.currentTarget)[this.model.hasLinkedValues?"addClass":"removeClass"]("is-pressed")},onSelect:function(e){this.isBusy||("appearance"!==this.model.get("name")||"custom"!==this.selected||window.confirm(wp.i18n._x("This will remove your custom settings, are you sure you want to continue?.","admin-text","site-reviews-themes"))?this.updateModel(e.currentTarget):jQuery(e.target).val(this.selected))},refresh:function(){this.render()},render:function(){this.$el.html(this.template(this.model.attributes));var e=this.templates[this.model.get("type")];return e?(this.el.dataset.type=this.model.get("type"),this.$el.find(".glsr-input").html(_.template(jQuery(e).html())(this.model.attributes))):console.error(this.model.attributes),this.storeSelection(),this},storeSelection:function(){"appearance"===this.model.get("name")&&(this.selected=this.model.get("value"))},updateLinkedColors:function(e){if(this.model.hasLinkedValues&&"text"===e.type){var t=jQuery(e).closest(".glsrt-ratingcolors"),i=jQuery(e).iris("color");t.find("input[data-linked]").each((function(e,t){return jQuery(t).iris("color",i)}))}},updateLinkedDimensions:function(e){if(this.model.hasLinkedValues&&"number"===e.type){var t=jQuery(e).closest(".glsrt-dimensions"),i=e.value;t.find("[type=number]").each((function(e,t){return t.value=i}))}},updateLinkedRange:function(e){e.previousElementSibling&&"range"===e.previousElementSibling.type&&(e.previousElementSibling.value=e.value),"range"===e.type&&e.nextElementSibling&&"number"===e.nextElementSibling.type&&(e.nextElementSibling.value=e.value)},updateModel:function(e){this.isBusy=!0,this.updateLinkedColors(e),this.updateLinkedDimensions(e),this.updateLinkedRange(e),this.model.set("value",this.value(e),{validate:!0}),this.isBusy=!1},value:function(e){var t=this.model.get("type");if(~["boxshadow","dimensions","excerpt","ratingcolors","typography"].indexOf(t)){var i=jQuery(e).closest(".glsr-metabox-field").find("input[data-linked], select[data-linked]"),n=_.map(i,(function(e){return jQuery(e).hasClass(".glsr-color-picker")?jQuery(e).iris("color"):e.value}));return~["boxshadow","excerpt","typography"].indexOf(t)||n.push(+this.model.hasLinkedValues),n.join("|")}return e.value}}),C=Backbone.View.extend({className:"components-panel",group:null,opened:!1,panel:null,section:null,tagName:"div",template:null,metabox:null,events:{"click .components-panel__body-toggle":"togglePanel"},initialize:function(e){_.extend(this,_.pick(e,"group","metabox","panel","section")),this.template=_.template(jQuery("#tmpl-glsrt-setting-panel").html()),this.listenTo(this.metabox,"close:panels",this.closePanels),this.listenTo(this.metabox,"toggle:group",this.toggleGroup)},closePanels:function(){this.$el.find(".components-panel__body").removeClass("is-opened"),this.opened=!1},render:function(){var e=this;this.$el.html(this.template({section:this.section,dashicon:this.panel.dashicon,label:this.panel.label,opened:!1})),this.$el.attr("data-group",this.group);var t=this.$el.find(".glsrt-fields");return _.each(this.panel.controls,(function(i,n){var o=e.metabox.collections[e.group].findWhere((function(e){return e.get("name")===n}));if(o){var r=new S({model:o});t.append(r.render().el)}})),this},toggleGroup:function(e){this.metabox.trigger("close:panels"),this.$el[e===this.group?"show":"hide"]()},togglePanel:function(){var e=this.opened;this.metabox.trigger("close:panels"),e||(this.$el.find(".components-panel__body").addClass("is-opened"),this.opened=!0)}}),T=C,k=Backbone.View.extend({el:"#glsrt-settings",metabox:null,initialize:function(e){_.extend(this,_.pick(e,"metabox")),this.listenTo(this.metabox,"document:keydown",this.onBodyKeydown)},onBodyKeydown:function(e){~["Enter"].indexOf(e.key)&&"INPUT"===e.target.tagName&&this.el.contains(e.target)&&e.preventDefault()},render:function(){var e=this;return this.$el.html(""),_.each(this.metabox.data,(function(t,i){_.each(t.data,(function(t,n){var o=new T({group:i,metabox:e.metabox,panel:t,section:n});e.$el.append(o.render().el)}))})),this}}),D=Backbone.View.extend({el:"#glsrt-metabox-settings",data:{},collections:{},addon:null,navigation:null,settings:null,theme:null,initialize:function(e){_.extend(this,_.pick(e,"addon")),this.navigation=new w({metabox:this}),this.settings=new k({metabox:this})},getSettings:function(){var e={};return _.each(this.collections,(function(t,i){e[i]={},t.each((function(t){var n=t.get("name"),o=t.get("value"),r=t.get("section");e[i][r]||(e[i][r]={}),e[i][r][n]=o}))})),e},handleDependencies:function(){var e=this;_.each(this.collections,(function(t,i){t.each((function(t){return e.handleDependency(t)}))}))},handleDependency:function(e){var t=e.get("group")+"."+e.get("section")+"."+e.get("name"),i=e.get("value");_.each(this.collections,(function(e,n){var o=e.filter((function(e){return _.find(e.get("depends_on"),(function(e,i){return i===t}))}));_.each(o,(function(e){var n=e.get("depends_on"),o=_.isArray(n[t])?n[t]:[n[t]];e.trigger(~o.indexOf(i)?"model:show":"model:hide")}))}))},populateCollections:function(){var e=this;_.each(this.data,(function(t,i){e.collections[i]=new x,_.each(t.data,(function(t,n){_.each(t.controls,(function(t){e.collections[i].add(t)}))}))}))},refresh:function(e){e&&this.syncAppearance(e),this.syncData(),this.handleDependencies(),this.theme.trigger("theme:refresh")},render:function(){var e=this;return this.populateCollections(),this.settings.render(),this.navigation.render(),this.refresh(),_.each(this.collections,(function(t){e.listenTo(t,"change",_.debounce(e.refresh,5))})),this},syncAppearance:function(e){var t=this,i=this.collections.presentation.findWhere({name:"appearance"}),n=_.get(this.theme.builder.data.styles,i.get("value"));if("custom"!==i.get("value")){if("appearance"!==e.get("name")){var o=e.get("group"),r=e.get("section"),l=e.get("name"),a=_.get(n,[o,r,l]);a&&a!==e.get(a)&&(i.set("value","custom",{silent:!0}),i.trigger("model:refresh"))}else _.each(n,(function(e,i){_.each(e,(function(e,n){_.each(e,(function(e,o){var r=t.collections[i].findWhere({section:n,name:o});r&&(r.set("value",e,{silent:!0}),r.trigger("model:refresh"))}))}))}));this.settings.metabox.trigger("colorpicker"),this.settings.metabox.trigger("tippy")}},syncData:function(){this.$el.find("[data-settings]").val(JSON.stringify(this.getSettings()))},values:function(){var e={};return _.each(this.collections,(function(t){t.each((function(t){var i=t.get("name");e[i]={default:t.get("default"),theme:t.get("theme"),type:t.get("type"),value:t.get("value")}}))})),e}}),E=D,M=Backbone.View.extend({el:"#glsrt-form",selected:"",metabox:null,events:{"change select":"onChangeForm","focus select":"onFocusForm"},initialize:function(e){_.extend(this,_.pick(e,"metabox")),this.selected=this.$el.find("select").val()},buildShortcodes:function(e){var t=this,i=jQuery("#post_ID").val();jQuery("#shortcodesdiv [data-shortcode]").each((function(e,n){var o=jQuery(n),r=[o.data("shortcode")];r.push('theme="'+i+'"'),1===o.data("form")&&t.selected&&r.push('form="'+i+'"'),o.text("["+r.join(" ")+"]")}))},fetchTags:function(e){var t=this;return this.metabox.tags.$el.hide(),this.metabox.$el.find(".loading-content").show(),wp.ajax.post(GLSR.action,s("theme-tags",{formid:e})).then((function(e){t.metabox.data=e.tags,t.metabox.theme.reviews=e.reviews,t.metabox.tags.render(),t.metabox.theme.trigger("builder:purge",t.metabox.tags.collection),t.metabox.theme.trigger("sortable"),t.metabox.$el.find(".loading-content").hide(),t.metabox.tags.$el.show()}))},onChangeForm:function(e){var t=this,i=jQuery(e.target),n=i.val();window.confirm(wp.i18n._x("Are you sure you want to change the form? This action will remove any fields from the builder which do not exist in the form.","admin-text","site-reviews-themes"))?(i.attr("disabled",!0),this.fetchTags(n).then((function(){t.selected=n,t.buildShortcodes(n),i.removeAttr("disabled")}))):i.val(this.selected)},onFocusForm:function(e){this.selected=jQuery(e.target).val()}});function A(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function O(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?A(Object(i),!0).forEach((function(t){F(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):A(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function N(e){return N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},N(e)}function F(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function $(){return $=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},$.apply(this,arguments)}function j(e,t){if(null==e)return{};var i,n,o=function(e,t){if(null==e)return{};var i,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)i=r[n],t.indexOf(i)>=0||(o[i]=e[i]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)i=r[n],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(o[i]=e[i])}return o}function B(e){if("undefined"!=typeof window&&window.navigator)return!!navigator.userAgent.match(e)}var I=B(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),P=B(/Edge/i),R=B(/firefox/i),L=B(/safari/i)&&!B(/chrome/i)&&!B(/android/i),Q=B(/iP(ad|od|hone)/i),V=B(/chrome/i)&&B(/android/i),X={capture:!1,passive:!1};function W(e,t,i){e.addEventListener(t,i,!I&&X)}function Y(e,t,i){e.removeEventListener(t,i,!I&&X)}function z(e,t){if(t){if(">"===t[0]&&(t=t.substring(1)),e)try{if(e.matches)return e.matches(t);if(e.msMatchesSelector)return e.msMatchesSelector(t);if(e.webkitMatchesSelector)return e.webkitMatchesSelector(t)}catch(e){return!1}return!1}}function G(e){return e.host&&e!==document&&e.host.nodeType?e.host:e.parentNode}function H(e,t,i,n){if(e){i=i||document;do{if(null!=t&&(">"===t[0]?e.parentNode===i&&z(e,t):z(e,t))||n&&e===i)return e;if(e===i)break}while(e=G(e))}return null}var U,J=/\s+/g;function K(e,t,i){if(e&&t)if(e.classList)e.classList[i?"add":"remove"](t);else{var n=(" "+e.className+" ").replace(J," ").replace(" "+t+" "," ");e.className=(n+(i?" "+t:"")).replace(J," ")}}function q(e,t,i){var n=e&&e.style;if(n){if(void 0===i)return document.defaultView&&document.defaultView.getComputedStyle?i=document.defaultView.getComputedStyle(e,""):e.currentStyle&&(i=e.currentStyle),void 0===t?i:i[t];t in n||-1!==t.indexOf("webkit")||(t="-webkit-"+t),n[t]=i+("string"==typeof i?"":"px")}}function Z(e,t){var i="";if("string"==typeof e)i=e;else do{var n=q(e,"transform");n&&"none"!==n&&(i=n+" "+i)}while(!t&&(e=e.parentNode));var o=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return o&&new o(i)}function ee(e,t,i){if(e){var n=e.getElementsByTagName(t),o=0,r=n.length;if(i)for(;o<r;o++)i(n[o],o);return n}return[]}function te(){var e=document.scrollingElement;return e||document.documentElement}function ie(e,t,i,n,o){if(e.getBoundingClientRect||e===window){var r,l,a,s,d,c,u;if(e!==window&&e.parentNode&&e!==te()?(l=(r=e.getBoundingClientRect()).top,a=r.left,s=r.bottom,d=r.right,c=r.height,u=r.width):(l=0,a=0,s=window.innerHeight,d=window.innerWidth,c=window.innerHeight,u=window.innerWidth),(t||i)&&e!==window&&(o=o||e.parentNode,!I))do{if(o&&o.getBoundingClientRect&&("none"!==q(o,"transform")||i&&"static"!==q(o,"position"))){var h=o.getBoundingClientRect();l-=h.top+parseInt(q(o,"border-top-width")),a-=h.left+parseInt(q(o,"border-left-width")),s=l+r.height,d=a+r.width;break}}while(o=o.parentNode);if(n&&e!==window){var p=Z(o||e),g=p&&p.a,f=p&&p.d;p&&(s=(l/=f)+(c/=f),d=(a/=g)+(u/=g))}return{top:l,left:a,bottom:s,right:d,width:u,height:c}}}function ne(e,t,i){for(var n=se(e,!0),o=ie(e)[t];n;){var r=ie(n)[i];if(!("top"===i||"left"===i?o>=r:o<=r))return n;if(n===te())break;n=se(n,!1)}return!1}function oe(e,t,i,n){for(var o=0,r=0,l=e.children;r<l.length;){if("none"!==l[r].style.display&&l[r]!==ht.ghost&&(n||l[r]!==ht.dragged)&&H(l[r],i.draggable,e,!1)){if(o===t)return l[r];o++}r++}return null}function re(e,t){for(var i=e.lastElementChild;i&&(i===ht.ghost||"none"===q(i,"display")||t&&!z(i,t));)i=i.previousElementSibling;return i||null}function le(e,t){var i=0;if(!e||!e.parentNode)return-1;for(;e=e.previousElementSibling;)"TEMPLATE"===e.nodeName.toUpperCase()||e===ht.clone||t&&!z(e,t)||i++;return i}function ae(e){var t=0,i=0,n=te();if(e)do{var o=Z(e),r=o.a,l=o.d;t+=e.scrollLeft*r,i+=e.scrollTop*l}while(e!==n&&(e=e.parentNode));return[t,i]}function se(e,t){if(!e||!e.getBoundingClientRect)return te();var i=e,n=!1;do{if(i.clientWidth<i.scrollWidth||i.clientHeight<i.scrollHeight){var o=q(i);if(i.clientWidth<i.scrollWidth&&("auto"==o.overflowX||"scroll"==o.overflowX)||i.clientHeight<i.scrollHeight&&("auto"==o.overflowY||"scroll"==o.overflowY)){if(!i.getBoundingClientRect||i===document.body)return te();if(n||t)return i;n=!0}}}while(i=i.parentNode);return te()}function de(e,t){return Math.round(e.top)===Math.round(t.top)&&Math.round(e.left)===Math.round(t.left)&&Math.round(e.height)===Math.round(t.height)&&Math.round(e.width)===Math.round(t.width)}function ce(e,t){return function(){if(!U){var i=arguments,n=this;1===i.length?e.call(n,i[0]):e.apply(n,i),U=setTimeout((function(){U=void 0}),t)}}}function ue(e,t,i){e.scrollLeft+=t,e.scrollTop+=i}function he(e){var t=window.Polymer,i=window.jQuery||window.Zepto;return t&&t.dom?t.dom(e).cloneNode(!0):i?i(e).clone(!0)[0]:e.cloneNode(!0)}var pe="Sortable"+(new Date).getTime();function ge(){var e,t=[];return{captureAnimationState:function(){(t=[],this.options.animation)&&[].slice.call(this.el.children).forEach((function(e){if("none"!==q(e,"display")&&e!==ht.ghost){t.push({target:e,rect:ie(e)});var i=O({},t[t.length-1].rect);if(e.thisAnimationDuration){var n=Z(e,!0);n&&(i.top-=n.f,i.left-=n.e)}e.fromRect=i}}))},addAnimationState:function(e){t.push(e)},removeAnimationState:function(e){t.splice(function(e,t){for(var i in e)if(e.hasOwnProperty(i))for(var n in t)if(t.hasOwnProperty(n)&&t[n]===e[i][n])return Number(i);return-1}(t,{target:e}),1)},animateAll:function(i){var n=this;if(!this.options.animation)return clearTimeout(e),void("function"==typeof i&&i());var o=!1,r=0;t.forEach((function(e){var t=0,i=e.target,l=i.fromRect,a=ie(i),s=i.prevFromRect,d=i.prevToRect,c=e.rect,u=Z(i,!0);u&&(a.top-=u.f,a.left-=u.e),i.toRect=a,i.thisAnimationDuration&&de(s,a)&&!de(l,a)&&(c.top-a.top)/(c.left-a.left)==(l.top-a.top)/(l.left-a.left)&&(t=function(e,t,i,n){return Math.sqrt(Math.pow(t.top-e.top,2)+Math.pow(t.left-e.left,2))/Math.sqrt(Math.pow(t.top-i.top,2)+Math.pow(t.left-i.left,2))*n.animation}(c,s,d,n.options)),de(a,l)||(i.prevFromRect=l,i.prevToRect=a,t||(t=n.options.animation),n.animate(i,c,a,t)),t&&(o=!0,r=Math.max(r,t),clearTimeout(i.animationResetTimer),i.animationResetTimer=setTimeout((function(){i.animationTime=0,i.prevFromRect=null,i.fromRect=null,i.prevToRect=null,i.thisAnimationDuration=null}),t),i.thisAnimationDuration=t)})),clearTimeout(e),o?e=setTimeout((function(){"function"==typeof i&&i()}),r):"function"==typeof i&&i(),t=[]},animate:function(e,t,i,n){if(n){q(e,"transition",""),q(e,"transform","");var o=Z(this.el),r=o&&o.a,l=o&&o.d,a=(t.left-i.left)/(r||1),s=(t.top-i.top)/(l||1);e.animatingX=!!a,e.animatingY=!!s,q(e,"transform","translate3d("+a+"px,"+s+"px,0)"),this.forRepaintDummy=function(e){return e.offsetWidth}(e),q(e,"transition","transform "+n+"ms"+(this.options.easing?" "+this.options.easing:"")),q(e,"transform","translate3d(0,0,0)"),"number"==typeof e.animated&&clearTimeout(e.animated),e.animated=setTimeout((function(){q(e,"transition",""),q(e,"transform",""),e.animated=!1,e.animatingX=!1,e.animatingY=!1}),n)}}}}var fe=[],me={initializeByDefault:!0},ve={mount:function(e){for(var t in me)me.hasOwnProperty(t)&&!(t in e)&&(e[t]=me[t]);fe.forEach((function(t){if(t.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")})),fe.push(e)},pluginEvent:function(e,t,i){var n=this;this.eventCanceled=!1,i.cancel=function(){n.eventCanceled=!0};var o=e+"Global";fe.forEach((function(n){t[n.pluginName]&&(t[n.pluginName][o]&&t[n.pluginName][o](O({sortable:t},i)),t.options[n.pluginName]&&t[n.pluginName][e]&&t[n.pluginName][e](O({sortable:t},i)))}))},initializePlugins:function(e,t,i,n){for(var o in fe.forEach((function(n){var o=n.pluginName;if(e.options[o]||n.initializeByDefault){var r=new n(e,t,e.options);r.sortable=e,r.options=e.options,e[o]=r,$(i,r.defaults)}})),e.options)if(e.options.hasOwnProperty(o)){var r=this.modifyOption(e,o,e.options[o]);void 0!==r&&(e.options[o]=r)}},getEventProperties:function(e,t){var i={};return fe.forEach((function(n){"function"==typeof n.eventProperties&&$(i,n.eventProperties.call(t[n.pluginName],e))})),i},modifyOption:function(e,t,i){var n;return fe.forEach((function(o){e[o.pluginName]&&o.optionListeners&&"function"==typeof o.optionListeners[t]&&(n=o.optionListeners[t].call(e[o.pluginName],i))})),n}};function be(e){var t=e.sortable,i=e.rootEl,n=e.name,o=e.targetEl,r=e.cloneEl,l=e.toEl,a=e.fromEl,s=e.oldIndex,d=e.newIndex,c=e.oldDraggableIndex,u=e.newDraggableIndex,h=e.originalEvent,p=e.putSortable,g=e.extraEventProperties;if(t=t||i&&i[pe]){var f,m=t.options,v="on"+n.charAt(0).toUpperCase()+n.substr(1);!window.CustomEvent||I||P?(f=document.createEvent("Event")).initEvent(n,!0,!0):f=new CustomEvent(n,{bubbles:!0,cancelable:!0}),f.to=l||i,f.from=a||i,f.item=o||i,f.clone=r,f.oldIndex=s,f.newIndex=d,f.oldDraggableIndex=c,f.newDraggableIndex=u,f.originalEvent=h,f.pullMode=p?p.lastPutMode:void 0;var b=O(O({},g),ve.getEventProperties(n,t));for(var w in b)f[w]=b[w];i&&i.dispatchEvent(f),m[v]&&m[v].call(t,f)}}var we=["evt"],ye=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=i.evt,o=j(i,we);ve.pluginEvent.bind(ht)(e,t,O({dragEl:_e,parentEl:Se,ghostEl:Ce,rootEl:Te,nextEl:ke,lastDownEl:De,cloneEl:Ee,cloneHidden:Me,dragStarted:Ve,putSortable:je,activeSortable:ht.active,originalEvent:n,oldIndex:Ae,oldDraggableIndex:Ne,newIndex:Oe,newDraggableIndex:Fe,hideGhostForTarget:st,unhideGhostForTarget:dt,cloneNowHidden:function(){Me=!0},cloneNowShown:function(){Me=!1},dispatchSortableEvent:function(e){xe({sortable:t,name:e,originalEvent:n})}},o))};function xe(e){be(O({putSortable:je,cloneEl:Ee,targetEl:_e,rootEl:Te,oldIndex:Ae,oldDraggableIndex:Ne,newIndex:Oe,newDraggableIndex:Fe},e))}var _e,Se,Ce,Te,ke,De,Ee,Me,Ae,Oe,Ne,Fe,$e,je,Be,Ie,Pe,Re,Le,Qe,Ve,Xe,We,Ye,ze,Ge=!1,He=!1,Ue=[],Je=!1,Ke=!1,qe=[],Ze=!1,et=[],tt="undefined"!=typeof document,it=Q,nt=P||I?"cssFloat":"float",ot=tt&&!V&&!Q&&"draggable"in document.createElement("div"),rt=function(){if(tt){if(I)return!1;var e=document.createElement("x");return e.style.cssText="pointer-events:auto","auto"===e.style.pointerEvents}}(),lt=function(e,t){var i=q(e),n=parseInt(i.width)-parseInt(i.paddingLeft)-parseInt(i.paddingRight)-parseInt(i.borderLeftWidth)-parseInt(i.borderRightWidth),o=oe(e,0,t),r=oe(e,1,t),l=o&&q(o),a=r&&q(r),s=l&&parseInt(l.marginLeft)+parseInt(l.marginRight)+ie(o).width,d=a&&parseInt(a.marginLeft)+parseInt(a.marginRight)+ie(r).width;if("flex"===i.display)return"column"===i.flexDirection||"column-reverse"===i.flexDirection?"vertical":"horizontal";if("grid"===i.display)return i.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(o&&l.float&&"none"!==l.float){var c="left"===l.float?"left":"right";return!r||"both"!==a.clear&&a.clear!==c?"horizontal":"vertical"}return o&&("block"===l.display||"flex"===l.display||"table"===l.display||"grid"===l.display||s>=n&&"none"===i[nt]||r&&"none"===i[nt]&&s+d>n)?"vertical":"horizontal"},at=function(e){function t(e,i){return function(n,o,r,l){var a=n.options.group.name&&o.options.group.name&&n.options.group.name===o.options.group.name;if(null==e&&(i||a))return!0;if(null==e||!1===e)return!1;if(i&&"clone"===e)return e;if("function"==typeof e)return t(e(n,o,r,l),i)(n,o,r,l);var s=(i?n:o).options.group.name;return!0===e||"string"==typeof e&&e===s||e.join&&e.indexOf(s)>-1}}var i={},n=e.group;n&&"object"==N(n)||(n={name:n}),i.name=n.name,i.checkPull=t(n.pull,!0),i.checkPut=t(n.put),i.revertClone=n.revertClone,e.group=i},st=function(){!rt&&Ce&&q(Ce,"display","none")},dt=function(){!rt&&Ce&&q(Ce,"display","")};tt&&!V&&document.addEventListener("click",(function(e){if(He)return e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),He=!1,!1}),!0);var ct=function(e){if(_e){e=e.touches?e.touches[0]:e;var t=(o=e.clientX,r=e.clientY,Ue.some((function(e){var t=e[pe].options.emptyInsertThreshold;if(t&&!re(e)){var i=ie(e),n=o>=i.left-t&&o<=i.right+t,a=r>=i.top-t&&r<=i.bottom+t;return n&&a?l=e:void 0}})),l);if(t){var i={};for(var n in e)e.hasOwnProperty(n)&&(i[n]=e[n]);i.target=i.rootEl=t,i.preventDefault=void 0,i.stopPropagation=void 0,t[pe]._onDragOver(i)}}var o,r,l},ut=function(e){_e&&_e.parentNode[pe]._isOutsideThisEl(e.target)};function ht(e,t){if(!e||!e.nodeType||1!==e.nodeType)throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(e));this.el=e,this.options=t=$({},t),e[pe]=this;var i={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(e.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return lt(e,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(e,t){e.setData("Text",t.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:!1!==ht.supportPointer&&"PointerEvent"in window&&!L,emptyInsertThreshold:5};for(var n in ve.initializePlugins(this,e,i),i)!(n in t)&&(t[n]=i[n]);for(var o in at(t),this)"_"===o.charAt(0)&&"function"==typeof this[o]&&(this[o]=this[o].bind(this));this.nativeDraggable=!t.forceFallback&&ot,this.nativeDraggable&&(this.options.touchStartThreshold=1),t.supportPointer?W(e,"pointerdown",this._onTapStart):(W(e,"mousedown",this._onTapStart),W(e,"touchstart",this._onTapStart)),this.nativeDraggable&&(W(e,"dragover",this),W(e,"dragenter",this)),Ue.push(this.el),t.store&&t.store.get&&this.sort(t.store.get(this)||[]),$(this,ge())}function pt(e,t,i,n,o,r,l,a){var s,d,c=e[pe],u=c.options.onMove;return!window.CustomEvent||I||P?(s=document.createEvent("Event")).initEvent("move",!0,!0):s=new CustomEvent("move",{bubbles:!0,cancelable:!0}),s.to=t,s.from=e,s.dragged=i,s.draggedRect=n,s.related=o||t,s.relatedRect=r||ie(t),s.willInsertAfter=a,s.originalEvent=l,e.dispatchEvent(s),u&&(d=u.call(c,s,l)),d}function gt(e){e.draggable=!1}function ft(){Ze=!1}function mt(e){for(var t=e.tagName+e.className+e.src+e.href+e.textContent,i=t.length,n=0;i--;)n+=t.charCodeAt(i);return n.toString(36)}function vt(e){return setTimeout(e,0)}function bt(e){return clearTimeout(e)}ht.prototype={constructor:ht,_isOutsideThisEl:function(e){this.el.contains(e)||e===this.el||(Xe=null)},_getDirection:function(e,t){return"function"==typeof this.options.direction?this.options.direction.call(this,e,t,_e):this.options.direction},_onTapStart:function(e){if(e.cancelable){var t=this,i=this.el,n=this.options,o=n.preventOnFilter,r=e.type,l=e.touches&&e.touches[0]||e.pointerType&&"touch"===e.pointerType&&e,a=(l||e).target,s=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||a,d=n.filter;if(function(e){et.length=0;var t=e.getElementsByTagName("input"),i=t.length;for(;i--;){var n=t[i];n.checked&&et.push(n)}}(i),!_e&&!(/mousedown|pointerdown/.test(r)&&0!==e.button||n.disabled)&&!s.isContentEditable&&(this.nativeDraggable||!L||!a||"SELECT"!==a.tagName.toUpperCase())&&!((a=H(a,n.draggable,i,!1))&&a.animated||De===a)){if(Ae=le(a),Ne=le(a,n.draggable),"function"==typeof d){if(d.call(this,e,a,this))return xe({sortable:t,rootEl:s,name:"filter",targetEl:a,toEl:i,fromEl:i}),ye("filter",t,{evt:e}),void(o&&e.cancelable&&e.preventDefault())}else if(d&&(d=d.split(",").some((function(n){if(n=H(s,n.trim(),i,!1))return xe({sortable:t,rootEl:n,name:"filter",targetEl:a,fromEl:i,toEl:i}),ye("filter",t,{evt:e}),!0}))))return void(o&&e.cancelable&&e.preventDefault());n.handle&&!H(s,n.handle,i,!1)||this._prepareDragStart(e,l,a)}}},_prepareDragStart:function(e,t,i){var n,o=this,r=o.el,l=o.options,a=r.ownerDocument;if(i&&!_e&&i.parentNode===r){var s=ie(i);if(Te=r,Se=(_e=i).parentNode,ke=_e.nextSibling,De=i,$e=l.group,ht.dragged=_e,Be={target:_e,clientX:(t||e).clientX,clientY:(t||e).clientY},Le=Be.clientX-s.left,Qe=Be.clientY-s.top,this._lastX=(t||e).clientX,this._lastY=(t||e).clientY,_e.style["will-change"]="all",n=function(){ye("delayEnded",o,{evt:e}),ht.eventCanceled?o._onDrop():(o._disableDelayedDragEvents(),!R&&o.nativeDraggable&&(_e.draggable=!0),o._triggerDragStart(e,t),xe({sortable:o,name:"choose",originalEvent:e}),K(_e,l.chosenClass,!0))},l.ignore.split(",").forEach((function(e){ee(_e,e.trim(),gt)})),W(a,"dragover",ct),W(a,"mousemove",ct),W(a,"touchmove",ct),W(a,"mouseup",o._onDrop),W(a,"touchend",o._onDrop),W(a,"touchcancel",o._onDrop),R&&this.nativeDraggable&&(this.options.touchStartThreshold=4,_e.draggable=!0),ye("delayStart",this,{evt:e}),!l.delay||l.delayOnTouchOnly&&!t||this.nativeDraggable&&(P||I))n();else{if(ht.eventCanceled)return void this._onDrop();W(a,"mouseup",o._disableDelayedDrag),W(a,"touchend",o._disableDelayedDrag),W(a,"touchcancel",o._disableDelayedDrag),W(a,"mousemove",o._delayedDragTouchMoveHandler),W(a,"touchmove",o._delayedDragTouchMoveHandler),l.supportPointer&&W(a,"pointermove",o._delayedDragTouchMoveHandler),o._dragStartTimer=setTimeout(n,l.delay)}}},_delayedDragTouchMoveHandler:function(e){var t=e.touches?e.touches[0]:e;Math.max(Math.abs(t.clientX-this._lastX),Math.abs(t.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){_e&&gt(_e),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;Y(e,"mouseup",this._disableDelayedDrag),Y(e,"touchend",this._disableDelayedDrag),Y(e,"touchcancel",this._disableDelayedDrag),Y(e,"mousemove",this._delayedDragTouchMoveHandler),Y(e,"touchmove",this._delayedDragTouchMoveHandler),Y(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,t){t=t||"touch"==e.pointerType&&e,!this.nativeDraggable||t?this.options.supportPointer?W(document,"pointermove",this._onTouchMove):W(document,t?"touchmove":"mousemove",this._onTouchMove):(W(_e,"dragend",this),W(Te,"dragstart",this._onDragStart));try{document.selection?vt((function(){document.selection.empty()})):window.getSelection().removeAllRanges()}catch(e){}},_dragStarted:function(e,t){if(Ge=!1,Te&&_e){ye("dragStarted",this,{evt:t}),this.nativeDraggable&&W(document,"dragover",ut);var i=this.options;!e&&K(_e,i.dragClass,!1),K(_e,i.ghostClass,!0),ht.active=this,e&&this._appendGhost(),xe({sortable:this,name:"start",originalEvent:t})}else this._nulling()},_emulateDragOver:function(){if(Ie){this._lastX=Ie.clientX,this._lastY=Ie.clientY,st();for(var e=document.elementFromPoint(Ie.clientX,Ie.clientY),t=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(Ie.clientX,Ie.clientY))!==t;)t=e;if(_e.parentNode[pe]._isOutsideThisEl(e),t)do{if(t[pe]){if(t[pe]._onDragOver({clientX:Ie.clientX,clientY:Ie.clientY,target:e,rootEl:t})&&!this.options.dragoverBubble)break}e=t}while(t=t.parentNode);dt()}},_onTouchMove:function(e){if(Be){var t=this.options,i=t.fallbackTolerance,n=t.fallbackOffset,o=e.touches?e.touches[0]:e,r=Ce&&Z(Ce,!0),l=Ce&&r&&r.a,a=Ce&&r&&r.d,s=it&&ze&&ae(ze),d=(o.clientX-Be.clientX+n.x)/(l||1)+(s?s[0]-qe[0]:0)/(l||1),c=(o.clientY-Be.clientY+n.y)/(a||1)+(s?s[1]-qe[1]:0)/(a||1);if(!ht.active&&!Ge){if(i&&Math.max(Math.abs(o.clientX-this._lastX),Math.abs(o.clientY-this._lastY))<i)return;this._onDragStart(e,!0)}if(Ce){r?(r.e+=d-(Pe||0),r.f+=c-(Re||0)):r={a:1,b:0,c:0,d:1,e:d,f:c};var u="matrix(".concat(r.a,",").concat(r.b,",").concat(r.c,",").concat(r.d,",").concat(r.e,",").concat(r.f,")");q(Ce,"webkitTransform",u),q(Ce,"mozTransform",u),q(Ce,"msTransform",u),q(Ce,"transform",u),Pe=d,Re=c,Ie=o}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!Ce){var e=this.options.fallbackOnBody?document.body:Te,t=ie(_e,!0,it,!0,e),i=this.options;if(it){for(ze=e;"static"===q(ze,"position")&&"none"===q(ze,"transform")&&ze!==document;)ze=ze.parentNode;ze!==document.body&&ze!==document.documentElement?(ze===document&&(ze=te()),t.top+=ze.scrollTop,t.left+=ze.scrollLeft):ze=te(),qe=ae(ze)}K(Ce=_e.cloneNode(!0),i.ghostClass,!1),K(Ce,i.fallbackClass,!0),K(Ce,i.dragClass,!0),q(Ce,"transition",""),q(Ce,"transform",""),q(Ce,"box-sizing","border-box"),q(Ce,"margin",0),q(Ce,"top",t.top),q(Ce,"left",t.left),q(Ce,"width",t.width),q(Ce,"height",t.height),q(Ce,"opacity","0.8"),q(Ce,"position",it?"absolute":"fixed"),q(Ce,"zIndex","100000"),q(Ce,"pointerEvents","none"),ht.ghost=Ce,e.appendChild(Ce),q(Ce,"transform-origin",Le/parseInt(Ce.style.width)*100+"% "+Qe/parseInt(Ce.style.height)*100+"%")}},_onDragStart:function(e,t){var i=this,n=e.dataTransfer,o=i.options;ye("dragStart",this,{evt:e}),ht.eventCanceled?this._onDrop():(ye("setupClone",this),ht.eventCanceled||((Ee=he(_e)).removeAttribute("id"),Ee.draggable=!1,Ee.style["will-change"]="",this._hideClone(),K(Ee,this.options.chosenClass,!1),ht.clone=Ee),i.cloneId=vt((function(){ye("clone",i),ht.eventCanceled||(i.options.removeCloneOnHide||Te.insertBefore(Ee,_e),i._hideClone(),xe({sortable:i,name:"clone"}))})),!t&&K(_e,o.dragClass,!0),t?(He=!0,i._loopId=setInterval(i._emulateDragOver,50)):(Y(document,"mouseup",i._onDrop),Y(document,"touchend",i._onDrop),Y(document,"touchcancel",i._onDrop),n&&(n.effectAllowed="move",o.setData&&o.setData.call(i,n,_e)),W(document,"drop",i),q(_e,"transform","translateZ(0)")),Ge=!0,i._dragStartId=vt(i._dragStarted.bind(i,t,e)),W(document,"selectstart",i),Ve=!0,L&&q(document.body,"user-select","none"))},_onDragOver:function(e){var t,i,n,o,r=this.el,l=e.target,a=this.options,s=a.group,d=ht.active,c=$e===s,u=a.sort,h=je||d,p=this,g=!1;if(!Ze){if(void 0!==e.preventDefault&&e.cancelable&&e.preventDefault(),l=H(l,a.draggable,r,!0),M("dragOver"),ht.eventCanceled)return g;if(_e.contains(e.target)||l.animated&&l.animatingX&&l.animatingY||p._ignoreWhileAnimating===l)return N(!1);if(He=!1,d&&!a.disabled&&(c?u||(n=Se!==Te):je===this||(this.lastPutMode=$e.checkPull(this,d,_e,e))&&s.checkPut(this,d,_e,e))){if(o="vertical"===this._getDirection(e,l),t=ie(_e),M("dragOverValid"),ht.eventCanceled)return g;if(n)return Se=Te,A(),this._hideClone(),M("revert"),ht.eventCanceled||(ke?Te.insertBefore(_e,ke):Te.appendChild(_e)),N(!0);var f=re(r,a.draggable);if(!f||function(e,t,i){var n=ie(re(i.el,i.options.draggable)),o=10;return t?e.clientX>n.right+o||e.clientX<=n.right&&e.clientY>n.bottom&&e.clientX>=n.left:e.clientX>n.right&&e.clientY>n.top||e.clientX<=n.right&&e.clientY>n.bottom+o}(e,o,this)&&!f.animated){if(f===_e)return N(!1);if(f&&r===e.target&&(l=f),l&&(i=ie(l)),!1!==pt(Te,r,_e,t,l,i,e,!!l))return A(),f&&f.nextSibling?r.insertBefore(_e,f.nextSibling):r.appendChild(_e),Se=r,F(),N(!0)}else if(f&&function(e,t,i){var n=ie(oe(i.el,0,i.options,!0)),o=10;return t?e.clientX<n.left-o||e.clientY<n.top&&e.clientX<n.right:e.clientY<n.top-o||e.clientY<n.bottom&&e.clientX<n.left}(e,o,this)){var m=oe(r,0,a,!0);if(m===_e)return N(!1);if(i=ie(l=m),!1!==pt(Te,r,_e,t,l,i,e,!1))return A(),r.insertBefore(_e,m),Se=r,F(),N(!0)}else if(l.parentNode===r){i=ie(l);var v,b,w,y=_e.parentNode!==r,x=!function(e,t,i){var n=i?e.left:e.top,o=i?e.right:e.bottom,r=i?e.width:e.height,l=i?t.left:t.top,a=i?t.right:t.bottom,s=i?t.width:t.height;return n===l||o===a||n+r/2===l+s/2}(_e.animated&&_e.toRect||t,l.animated&&l.toRect||i,o),_=o?"top":"left",S=ne(l,"top","top")||ne(_e,"top","top"),C=S?S.scrollTop:void 0;if(Xe!==l&&(b=i[_],Je=!1,Ke=!x&&a.invertSwap||y),v=function(e,t,i,n,o,r,l,a){var s=n?e.clientY:e.clientX,d=n?i.height:i.width,c=n?i.top:i.left,u=n?i.bottom:i.right,h=!1;if(!l)if(a&&Ye<d*o){if(!Je&&(1===We?s>c+d*r/2:s<u-d*r/2)&&(Je=!0),Je)h=!0;else if(1===We?s<c+Ye:s>u-Ye)return-We}else if(s>c+d*(1-o)/2&&s<u-d*(1-o)/2)return function(e){return le(_e)<le(e)?1:-1}(t);if((h=h||l)&&(s<c+d*r/2||s>u-d*r/2))return s>c+d/2?1:-1;return 0}(e,l,i,o,x?1:a.swapThreshold,null==a.invertedSwapThreshold?a.swapThreshold:a.invertedSwapThreshold,Ke,Xe===l),0!==v){var T=le(_e);do{T-=v,w=Se.children[T]}while(w&&("none"===q(w,"display")||w===Ce))}if(0===v||w===l)return N(!1);Xe=l,We=v;var k=l.nextElementSibling,D=!1,E=pt(Te,r,_e,t,l,i,e,D=1===v);if(!1!==E)return 1!==E&&-1!==E||(D=1===E),Ze=!0,setTimeout(ft,30),A(),D&&!k?r.appendChild(_e):l.parentNode.insertBefore(_e,D?k:l),S&&ue(S,0,C-S.scrollTop),Se=_e.parentNode,void 0===b||Ke||(Ye=Math.abs(b-ie(l)[_])),F(),N(!0)}if(r.contains(_e))return N(!1)}return!1}function M(a,s){ye(a,p,O({evt:e,isOwner:c,axis:o?"vertical":"horizontal",revert:n,dragRect:t,targetRect:i,canSort:u,fromSortable:h,target:l,completed:N,onMove:function(i,n){return pt(Te,r,_e,t,i,ie(i),e,n)},changed:F},s))}function A(){M("dragOverAnimationCapture"),p.captureAnimationState(),p!==h&&h.captureAnimationState()}function N(t){return M("dragOverCompleted",{insertion:t}),t&&(c?d._hideClone():d._showClone(p),p!==h&&(K(_e,je?je.options.ghostClass:d.options.ghostClass,!1),K(_e,a.ghostClass,!0)),je!==p&&p!==ht.active?je=p:p===ht.active&&je&&(je=null),h===p&&(p._ignoreWhileAnimating=l),p.animateAll((function(){M("dragOverAnimationComplete"),p._ignoreWhileAnimating=null})),p!==h&&(h.animateAll(),h._ignoreWhileAnimating=null)),(l===_e&&!_e.animated||l===r&&!l.animated)&&(Xe=null),a.dragoverBubble||e.rootEl||l===document||(_e.parentNode[pe]._isOutsideThisEl(e.target),!t&&ct(e)),!a.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),g=!0}function F(){Oe=le(_e),Fe=le(_e,a.draggable),xe({sortable:p,name:"change",toEl:r,newIndex:Oe,newDraggableIndex:Fe,originalEvent:e})}},_ignoreWhileAnimating:null,_offMoveEvents:function(){Y(document,"mousemove",this._onTouchMove),Y(document,"touchmove",this._onTouchMove),Y(document,"pointermove",this._onTouchMove),Y(document,"dragover",ct),Y(document,"mousemove",ct),Y(document,"touchmove",ct)},_offUpEvents:function(){var e=this.el.ownerDocument;Y(e,"mouseup",this._onDrop),Y(e,"touchend",this._onDrop),Y(e,"pointerup",this._onDrop),Y(e,"touchcancel",this._onDrop),Y(document,"selectstart",this)},_onDrop:function(e){var t=this.el,i=this.options;Oe=le(_e),Fe=le(_e,i.draggable),ye("drop",this,{evt:e}),Se=_e&&_e.parentNode,Oe=le(_e),Fe=le(_e,i.draggable),ht.eventCanceled||(Ge=!1,Ke=!1,Je=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),bt(this.cloneId),bt(this._dragStartId),this.nativeDraggable&&(Y(document,"drop",this),Y(t,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),L&&q(document.body,"user-select",""),q(_e,"transform",""),e&&(Ve&&(e.cancelable&&e.preventDefault(),!i.dropBubble&&e.stopPropagation()),Ce&&Ce.parentNode&&Ce.parentNode.removeChild(Ce),(Te===Se||je&&"clone"!==je.lastPutMode)&&Ee&&Ee.parentNode&&Ee.parentNode.removeChild(Ee),_e&&(this.nativeDraggable&&Y(_e,"dragend",this),gt(_e),_e.style["will-change"]="",Ve&&!Ge&&K(_e,je?je.options.ghostClass:this.options.ghostClass,!1),K(_e,this.options.chosenClass,!1),xe({sortable:this,name:"unchoose",toEl:Se,newIndex:null,newDraggableIndex:null,originalEvent:e}),Te!==Se?(Oe>=0&&(xe({rootEl:Se,name:"add",toEl:Se,fromEl:Te,originalEvent:e}),xe({sortable:this,name:"remove",toEl:Se,originalEvent:e}),xe({rootEl:Se,name:"sort",toEl:Se,fromEl:Te,originalEvent:e}),xe({sortable:this,name:"sort",toEl:Se,originalEvent:e})),je&&je.save()):Oe!==Ae&&Oe>=0&&(xe({sortable:this,name:"update",toEl:Se,originalEvent:e}),xe({sortable:this,name:"sort",toEl:Se,originalEvent:e})),ht.active&&(null!=Oe&&-1!==Oe||(Oe=Ae,Fe=Ne),xe({sortable:this,name:"end",toEl:Se,originalEvent:e}),this.save())))),this._nulling()},_nulling:function(){ye("nulling",this),Te=_e=Se=Ce=ke=Ee=De=Me=Be=Ie=Ve=Oe=Fe=Ae=Ne=Xe=We=je=$e=ht.dragged=ht.ghost=ht.clone=ht.active=null,et.forEach((function(e){e.checked=!0})),et.length=Pe=Re=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":_e&&(this._onDragOver(e),function(e){e.dataTransfer&&(e.dataTransfer.dropEffect="move");e.cancelable&&e.preventDefault()}(e));break;case"selectstart":e.preventDefault()}},toArray:function(){for(var e,t=[],i=this.el.children,n=0,o=i.length,r=this.options;n<o;n++)H(e=i[n],r.draggable,this.el,!1)&&t.push(e.getAttribute(r.dataIdAttr)||mt(e));return t},sort:function(e,t){var i={},n=this.el;this.toArray().forEach((function(e,t){var o=n.children[t];H(o,this.options.draggable,n,!1)&&(i[e]=o)}),this),t&&this.captureAnimationState(),e.forEach((function(e){i[e]&&(n.removeChild(i[e]),n.appendChild(i[e]))})),t&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,t){return H(e,t||this.options.draggable,this.el,!1)},option:function(e,t){var i=this.options;if(void 0===t)return i[e];var n=ve.modifyOption(this,e,t);i[e]=void 0!==n?n:t,"group"===e&&at(i)},destroy:function(){ye("destroy",this);var e=this.el;e[pe]=null,Y(e,"mousedown",this._onTapStart),Y(e,"touchstart",this._onTapStart),Y(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(Y(e,"dragover",this),Y(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),(function(e){e.removeAttribute("draggable")})),this._onDrop(),this._disableDelayedDragEvents(),Ue.splice(Ue.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!Me){if(ye("hideClone",this),ht.eventCanceled)return;q(Ee,"display","none"),this.options.removeCloneOnHide&&Ee.parentNode&&Ee.parentNode.removeChild(Ee),Me=!0}},_showClone:function(e){if("clone"===e.lastPutMode){if(Me){if(ye("showClone",this),ht.eventCanceled)return;_e.parentNode!=Te||this.options.group.revertClone?ke?Te.insertBefore(Ee,ke):Te.appendChild(Ee):Te.insertBefore(Ee,_e),this.options.group.revertClone&&this.animate(_e,Ee),q(Ee,"display",""),Me=!1}}else this._hideClone()}},tt&&W(document,"touchmove",(function(e){(ht.active||Ge)&&e.cancelable&&e.preventDefault()})),ht.utils={on:W,off:Y,css:q,find:ee,is:function(e,t){return!!H(e,t,e,!1)},extend:function(e,t){if(e&&t)for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},throttle:ce,closest:H,toggleClass:K,clone:he,index:le,nextTick:vt,cancelNextTick:bt,detectDirection:lt,getChild:oe},ht.get=function(e){return e[pe]},ht.mount=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];t[0].constructor===Array&&(t=t[0]),t.forEach((function(e){if(!e.prototype||!e.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(e));e.utils&&(ht.utils=O(O({},ht.utils),e.utils)),ve.mount(e)}))},ht.create=function(e,t){return new ht(e,t)},ht.version="1.15.0";var wt,yt,xt,_t,St,Ct,Tt=[],kt=!1;function Dt(){Tt.forEach((function(e){clearInterval(e.pid)})),Tt=[]}function Et(){clearInterval(Ct)}var Mt=ce((function(e,t,i,n){if(t.scroll){var o,r=(e.touches?e.touches[0]:e).clientX,l=(e.touches?e.touches[0]:e).clientY,a=t.scrollSensitivity,s=t.scrollSpeed,d=te(),c=!1;yt!==i&&(yt=i,Dt(),wt=t.scroll,o=t.scrollFn,!0===wt&&(wt=se(i,!0)));var u=0,h=wt;do{var p=h,g=ie(p),f=g.top,m=g.bottom,v=g.left,b=g.right,w=g.width,y=g.height,x=void 0,_=void 0,S=p.scrollWidth,C=p.scrollHeight,T=q(p),k=p.scrollLeft,D=p.scrollTop;p===d?(x=w<S&&("auto"===T.overflowX||"scroll"===T.overflowX||"visible"===T.overflowX),_=y<C&&("auto"===T.overflowY||"scroll"===T.overflowY||"visible"===T.overflowY)):(x=w<S&&("auto"===T.overflowX||"scroll"===T.overflowX),_=y<C&&("auto"===T.overflowY||"scroll"===T.overflowY));var E=x&&(Math.abs(b-r)<=a&&k+w<S)-(Math.abs(v-r)<=a&&!!k),M=_&&(Math.abs(m-l)<=a&&D+y<C)-(Math.abs(f-l)<=a&&!!D);if(!Tt[u])for(var A=0;A<=u;A++)Tt[A]||(Tt[A]={});Tt[u].vx==E&&Tt[u].vy==M&&Tt[u].el===p||(Tt[u].el=p,Tt[u].vx=E,Tt[u].vy=M,clearInterval(Tt[u].pid),0==E&&0==M||(c=!0,Tt[u].pid=setInterval(function(){n&&0===this.layer&&ht.active._onTouchMove(St);var t=Tt[this.layer].vy?Tt[this.layer].vy*s:0,i=Tt[this.layer].vx?Tt[this.layer].vx*s:0;"function"==typeof o&&"continue"!==o.call(ht.dragged.parentNode[pe],i,t,e,St,Tt[this.layer].el)||ue(Tt[this.layer].el,i,t)}.bind({layer:u}),24))),u++}while(t.bubbleScroll&&h!==d&&(h=se(h,!1)));kt=c}}),30),At=function(e){var t=e.originalEvent,i=e.putSortable,n=e.dragEl,o=e.activeSortable,r=e.dispatchSortableEvent,l=e.hideGhostForTarget,a=e.unhideGhostForTarget;if(t){var s=i||o;l();var d=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t,c=document.elementFromPoint(d.clientX,d.clientY);a(),s&&!s.el.contains(c)&&(r("spill"),this.onSpill({dragEl:n,putSortable:i}))}};function Ot(){}function Nt(){}Ot.prototype={startIndex:null,dragStart:function(e){var t=e.oldDraggableIndex;this.startIndex=t},onSpill:function(e){var t=e.dragEl,i=e.putSortable;this.sortable.captureAnimationState(),i&&i.captureAnimationState();var n=oe(this.sortable.el,this.startIndex,this.options);n?this.sortable.el.insertBefore(t,n):this.sortable.el.appendChild(t),this.sortable.animateAll(),i&&i.animateAll()},drop:At},$(Ot,{pluginName:"revertOnSpill"}),Nt.prototype={onSpill:function(e){var t=e.dragEl,i=e.putSortable||this.sortable;i.captureAnimationState(),t.parentNode&&t.parentNode.removeChild(t),i.animateAll()},drop:At},$(Nt,{pluginName:"removeOnSpill"});ht.mount(new function(){function e(){for(var e in this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0},this)"_"===e.charAt(0)&&"function"==typeof this[e]&&(this[e]=this[e].bind(this))}return e.prototype={dragStarted:function(e){var t=e.originalEvent;this.sortable.nativeDraggable?W(document,"dragover",this._handleAutoScroll):this.options.supportPointer?W(document,"pointermove",this._handleFallbackAutoScroll):t.touches?W(document,"touchmove",this._handleFallbackAutoScroll):W(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(e){var t=e.originalEvent;this.options.dragOverBubble||t.rootEl||this._handleAutoScroll(t)},drop:function(){this.sortable.nativeDraggable?Y(document,"dragover",this._handleAutoScroll):(Y(document,"pointermove",this._handleFallbackAutoScroll),Y(document,"touchmove",this._handleFallbackAutoScroll),Y(document,"mousemove",this._handleFallbackAutoScroll)),Et(),Dt(),clearTimeout(U),U=void 0},nulling:function(){St=yt=wt=kt=Ct=xt=_t=null,Tt.length=0},_handleFallbackAutoScroll:function(e){this._handleAutoScroll(e,!0)},_handleAutoScroll:function(e,t){var i=this,n=(e.touches?e.touches[0]:e).clientX,o=(e.touches?e.touches[0]:e).clientY,r=document.elementFromPoint(n,o);if(St=e,t||this.options.forceAutoScrollFallback||P||I||L){Mt(e,this.options,r,t);var l=se(r,!0);!kt||Ct&&n===xt&&o===_t||(Ct&&Et(),Ct=setInterval((function(){var r=se(document.elementFromPoint(n,o),!0);r!==l&&(l=r,Dt()),Mt(e,i.options,r,t)}),10),xt=n,_t=o)}else{if(!this.options.bubbleScroll||se(r,!0)===te())return void Dt();Mt(e,this.options,se(r,!1),!1)}}},$(e,{pluginName:"scroll",initializeByDefault:!0})}),ht.mount(Nt,Ot);var Ft=Backbone.View.extend({builder:null,model:null,review:null,template:null,initialize:function(e){_.extend(this,_.pick(e,"builder","review")),this.model.view=this,this.template=_.template(jQuery("#tmpl-glsrt-field").html())},render:function(){return this.setAppearance(),this.renderTag(),this},renderTag:function(){var e=this.builder.metabox.addon.tags.tags.collection.findWhere({tag:this.model.get("tag")}),t=_.get(this.review,this.model.get("tag")),i=t;if(e){if("textarea"===e.get("type")&&!_.isEmpty(t)){t=jQuery(t).html(),i=jQuery(i).html();var n=this.builder.metabox.settings.collections.presentation.findWhere({name:"excerpt_action"}),o=this.builder.metabox.settings.collections.presentation.findWhere({name:"excerpt_length"});"disabled"!==n.get("value")&&(t=d(i,o.get("value")))}this.$el.html(this.template(_.extend(e.toJSON(),{text:t,value:i})))}return this.model.isField()&&_.isEmpty(i)&&this.$el.css("display","none"),this},setAppearance:function(){var e=this;return this.$el.addClass(this.model.isField()?"field":"container"),this.model.get("align")&&this.$el.addClass(a("align",this.model.get("align"))),this.model.get("direction")&&this.$el.addClass("gl-flex gl-flex-"+this.model.get("direction")),this.model.get("flex")&&this.$el.addClass(a("flex",this.model.get("flex"))),this.model.get("gap")&&this.$el.css({gap:this.model.get("gap")+"px"}),this.model.get("minwidth")&&this.$el.css({minWidth:this.model.get("minwidth")+"px"}),this.model.get("text")&&this.$el.addClass(a("text",this.model.get("text"))),this.model.get("wrap")&&this.$el.addClass(a("wrap",this.model.get("wrap"))),_.each(["is_bold","is_hidden","is_italic","is_uppercase"],(function(t){e.model.get(t)&&e.$el.addClass(a(t))})),this}}),$t=Ft,jt=$t.extend({builder:null,model:null,template:null,attributes:function(){return{"data-id":this.model.cid,"data-index":this.model.get("index"),"data-level":this.model.get("level"),tabindex:0}},initialize:function(e){_.extend(this,_.pick(e,"builder")),this.model.view=this,this.template=_.template(jQuery("#tmpl-glsrt-field").html())},render:function(){return this.$el.addClass("draggable"),this.setAppearance(),this.renderTag(),this},renderTag:function(){var e=this.builder.metabox.addon.tags.tags.collection.findWhere({tag:this.model.get("tag")});if(e){var t=e.get("value"),i=t;if("textarea"===e.get("type")){var n=this.builder.metabox.settings.collections.presentation.findWhere({name:"excerpt_action"}),o=this.builder.metabox.settings.collections.presentation.findWhere({name:"excerpt_length"});"disabled"!==n.get("value")&&(t=d(i,o.get("value")))}this.$el.html(this.template(_.extend(e.toJSON(),{text:t,value:i})))}else this.$el.html("{{ unknown tag }}");return this}}),Bt=jt,It=Backbone.Model.extend({modelView:null,parent:null,isContainer:function(){return!1},isField:function(){return!1},validate:function(e,t){return e=_.pick(e,_.keys(this.defaults)),!0}}),Pt=It.extend({defaults:{flex:"",index:0,is_bold:!1,is_hidden:!1,is_italic:!1,is_uppercase:!1,level:0,tag:"",text:"normal"},modelView:Bt,isContainer:function(){return!1},isField:function(){return!0},isRoot:function(){return!1}}),Rt=Backbone.Model.extend({defaults:{custom:!1,tag:"",tag_label:"",type:"",value:""},view:null}),Lt=Backbone.Collection.extend({model:Rt}),Qt=Backbone.View.extend({className:"button button-secondary",tagName:"button",events:{click:"onClick"},builder:null,model:null,initialize:function(e){_.extend(this,_.pick(e,"builder")),this.model.view=this},onClick:function(e){var t=this;e.preventDefault();var i=new Pt({index:this.builder.collection.where((function(e){return 1==e.get("level")})).length,level:1,tag:this.builder.metabox.addon.tags.tags.collection.get(e.currentTarget.dataset.id).get("tag")});i.parent=this.builder.collection.findWhere((function(e){return 0==e.get("level")})),this.builder.collection.add(i),setTimeout((function(){t.builder.activate(),t.builder.fields.deselectField(),t.builder.fields.selectField(i)}),100)},render:function(){return this.$el.attr("data-id",this.model.cid),this.$el.attr("tabindex",0),this.$el.html(this.model.get("tag")),this}}),Vt=Qt,Xt=Backbone.View.extend({el:"#glsrt-tags",template:null,metabox:null,collection:null,sortable:null,initialize:function(e){_.extend(this,_.pick(e,"metabox")),this.collection=new Lt},initSortable:function(){var e=this;this.sortable&&this.sortable.destroy(),this.sortable=new ht(this.el,{group:{name:"container",pull:"clone",put:!1},sort:!1,touchStartThreshold:4,forceFallback:!0,onStart:function(t){e.metabox.theme.trigger("builder:activate"),e.metabox.theme.trigger("builder:deselect-field")},onEnd:function(t){if("clone"===t.pullMode){var i=ht.get(t.to).toArray(),n=e.metabox.theme.builder.collection.get(t.to.dataset.id),o=new Pt({index:t.newIndex,level:n.get("level")+1,tag:e.collection.get(t.item.dataset.id).get("tag")});o.parent=n,_.each(i,(function(t,i){var n=e.metabox.theme.builder.collection.get(t);void 0!==n&&n.set("index",i,{silent:!0})})),e.metabox.theme.builder.collection.add(o),setTimeout((function(){return e.metabox.theme.builder.fields.selectField(o)}),100)}else e.metabox.theme.trigger("builder:deactivate")}})},render:function(){var e=this;return this.$el.html(""),this.collection.reset(this.metabox.data),this.collection.each((function(t){var i=new Vt({builder:e.metabox.theme.builder,model:t});e.$el.append(i.render().el)})),this}}),Wt=Xt,Yt=Backbone.View.extend({el:"#glsrt-metabox-tags",data:{},events:{"click #glsrt-tags-hidden button":"openBuilder"},addon:null,forms:null,tags:null,theme:null,initialize:function(e){_.extend(this,_.pick(e,"addon")),this.forms=new M({metabox:this}),this.tags=new Wt({metabox:this})},openBuilder:function(){this.theme.trigger("toggle:group","builder")},render:function(){this.listenTo(this.theme,"sortable",this.tags.initSortable.bind(this.tags)),this.listenTo(this.theme,"toggle:group",this.toggleGroup),this.tags.render(),this.$el.find("#glsrt-tags-hidden").show(),this.$el.find(".loading-content").hide()},toggleGroup:function(e){var t="builder"===e?"show":"hide",i="builder"===e?"hide":"show";this.forms.$el[t](),this.tags.$el[t](),this.$el.find("#glsrt-tags-hidden")[i]()}}),zt=$t.extend({builder:null,model:null,sortable:null,attributes:function(){return{"data-container":this.model.get("direction"),"data-id":this.model.cid,"data-index":this.model.get("index"),"data-level":this.model.get("level"),tabindex:0}},initialize:function(e){_.extend(this,_.pick(e,"builder")),this.model.view=this,this.listenTo(this.builder.metabox,"sortable",this.initSortable)},initSortable:function(){var e=this;this.sortable&&this.sortable.destroy(),this.sortable=new ht(this.el,{animation:150,emptyInsertThreshold:0,filter:".glsrt-themebox:not(.is-active) [data-id]",group:"container",invertSwap:!0,preventOnFilter:!1,revertOnSpill:!0,touchStartThreshold:4,onAdd:function(e){},onChange:function(e){},onClone:function(e){},onEnd:function(t){e.builder.collection.get(t.item.dataset.id).parent=e.builder.collection.get(t.to.dataset.id),e.builder.fields.reset(),e.builder.fields.render()},onFilter:function(e){},onMove:function(e,t){},onRemove:function(e){},onSort:function(e){},onStart:function(t){e.builder.isActive||e.builder.activate(),e.builder.fields.selectFieldById(t.item.dataset.id)},onUpdate:function(e){}})},render:function(){return this.setAppearance(),this.model.parent?this.$el.addClass("draggable"):this.$el.attr("aria-label",wp.i18n._x("Drag and drop or click a template tag to add it to the review.","admin-text","site-reviews-themes")),this},renderTag:function(){return this}}),Gt=It.extend({defaults:{align:"stretch",direction:"col",flex:"grow",gap:12,index:0,level:0,minwidth:0,wrap:!1},modelView:zt,isContainer:function(){return!0},isField:function(){return!1},isRoot:function(){return 0===this.get("index")&&0===this.get("level")&&!this.parent},reset:function(){return this.set(this.defaults,{silent:!0}),this},toggleDirection:function(){var e="row"===this.get("direction")?"col":"row";return this.set({direction:e},{silent:!0}),this}}),Ht=Backbone.Collection.extend({comparator:function(e,t){var i=e.get("level"),n=t.get("level");this.sortReverse&&(i*=-1,n*=-1);var o=i-n;return 0===o?e.get("index")<t.get("index")?-1:1:o},consolidate:function(){var e=this;this.sortDesc({silent:!0});var t=[];if(this.each((function(i){if(!i.isField()&&!i.isRoot()){var n=e.filter((function(e){return e.parent===i})),o=_.findWhere(t,(function(e){return e.cid===i.cid}));_.isEmpty(n)&&!o&&t.push(i)}})),!_.isEmpty(t))return this.remove(t,{silent:!0}),void this.consolidate();this.sortAsc({silent:!0})},initialize:function(){this.sortReverse=!1},model:function(e){return e.tag?new Pt(e):new Gt(e)},populate:function(e,t){var i=this;if(_.isEmpty(e))this.add(new Gt);else{var n=t?t.get("level")+1:0;_.each(e,(function(e,o){var r=_.clone(e),l=r.children;delete r.children,r.index=o,r.level=n;var a=i.add(r);a.parent=t||null,l&&i.populate(l,a)}))}},purge:function(e){var t=this;this.each((function(i){i&&!i.isContainer()&&(e.findWhere({tag:i.get("tag")})||t.remove(i,{silent:!0}))}))},sortAsc:function(e){this.sortReverse=!1,this.sort(e)},sortDesc:function(e){this.sortReverse=!0,this.sort(e)}}),Ut=Ht,Jt=new function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=0,i=0;return{start:function(e){t=e.clientX,i=e.clientY},isClick:function(n){var o=Math.abs(n.clientX-t),r=Math.abs(n.clientY-i);return o<e&&r<e}}},Kt=Backbone.View.extend({el:"#glsrt-fields",events:{"focus [data-id]":"onFocusField","mousedown [data-id]":"onMousedownField","mouseup [data-id]":"onMouseupField"},builder:null,isClick:!1,selectedModel:null,initialize:function(e){_.extend(this,_.pick(e,"builder")),this.listenTo(this.builder.metabox,"builder:deselect-field",this.deselectField)},deselectField:function(){this.selectedModel&&(this.selectedModel=null,this.$el.find("[data-id]").removeClass("is-selected")),this.builder.isActive?(this.builder.renderToolbar(),this.builder.metabox.trigger("tippy")):this.builder.removeToolbar()},highlightField:function(){this.selectedModel&&this.selectedModel.view.$el.addClass("is-selected")},moveField:function(e){if(~["up","down"].indexOf(e)){var t=this.selectedModel.parent.view.sortable,i=this.selectedModel.cid,n=t.toArray(),o=n.indexOf(i),r="up"===e?o-1:o+1;r<0||r===n.length||(n.splice(o,1),n.splice(r,0,i),t.sort(n,!1),this.reset(),this.render(),this.selectedModel&&(this.isClick=!0,this.selectedModel.view.el.focus(),this.isClick=!1))}},onFocusField:function(e){this.isClick||Jt.isClick(e)||this.onSelectField(e)},onMousedownField:function(e){this.isClick=!0,Jt.start(e)},onMouseupField:function(e){var t=this;this.isClick=!1,this.eventFired||(this.eventFired=!0,setTimeout((function(){return t.eventFired=!1}),200),e.button>0||Jt.isClick(e)&&(this.builder.isActive?this.onSelectField(e):(this.builder.activate(),this.builder.renderToolbar(),this.builder.metabox.trigger("tippy"))))},onSelectField:function(e){e.preventDefault(),e.stopPropagation();var t=this.builder.collection.get(e.currentTarget.dataset.id);if(t){var i=this.selectedModel;this.deselectField(),t!==i&&this.selectField(t)}},removeField:function(){var e=this;this.selectedModel&&(this.selectedModel.view.$el.find("[data-id]").each((function(t,i){var n=e.builder.collection.get(i.dataset.id);n&&e.builder.collection.remove(n,{silent:!0})})),this.builder.collection.remove(this.selectedModel,{silent:!0}),0===this.builder.collection.length&&this.builder.collection.add(new Gt,{silent:!0}),1===this.builder.collection.length?(this.selectedModel=this.builder.collection.at(0),this.selectedModel.reset()):this.selectedModel=null,this.builder.metabox.refresh())},render:function(){var e=this,t=this.$el.find(".glsr-review");t.html(""),this.builder.collection.each((function(i){var n=new i.modelView({builder:e.builder,model:i}).render().el;i.parent?i.parent.view.$el.append(n):t.append(n)})),1===this.builder.collection.length&&this.builder.$el.addClass("is-active"),this.highlightField(),this.builder.metabox.trigger("sortable")},reset:function(){this.resetChildren(this.$el.children(),0),this.builder.syncData()},resetChildren:function(e,t){var i=this;e.each((function(e,n){var o=i.builder.collection.get(n.dataset.id);o?(o.set({index:e,level:t},{silent:!0}),i.resetChildren(jQuery(n).children(),t+1)):i.resetChildren(jQuery(n).children(),t)}))},selectField:function(e){this.selectedModel=e,this.highlightField(),this.builder.renderToolbar(),this.builder.metabox.trigger("tippy")},selectFieldById:function(e){var t=this.builder.collection.get(e);t&&(t!==this.selectedModel&&(this.deselectField(),this.selectField(t)))},wrapField:function(){var e=this.builder.fields.selectedModel;if(e){var t=this.builder.collection.add(new Gt,{silent:!0}),i=new zt({model:t,builder:this.builder}).render();e.parent&&(t.parent=e.parent),i.$el.insertBefore(e.view.$el),e.parent=t,e.view.$el.appendTo(i.$el),this.reset(),this.render()}}}),qt=Kt,Zt=Backbone.View.extend({el:"#glsrt-toolbar",template:null,events:{"change input[data-action=gap]":"onChangeGap","change input[data-action=minwidth]":"onChangeMinWidth","click [data-action=align]":"onAlign","click [data-action=direction]":"onFlexDirection","click [data-action=flex]":"onFlex","click [data-action=flex-wrap]":"onFlexWrap","click [data-action=is_bold]":"onToggleBold","click [data-action=is_hidden]":"onToggleHidden","click [data-action=is_italic]":"onToggleItalic","click [data-action=is_uppercase]":"onToggleUppercase","click [data-action=remove]":"onRemoveField","click [data-action=text]":"onText","click [data-action=wrap]":"onWrapField","input input[data-action=gap]":"onChangeGap","input input[data-action=minwidth]":"onChangeMinWidth"},builder:null,initialize:function(e){_.extend(this,_.pick(e,"builder")),this.template=_.template(jQuery("#tmpl-glsrt-toolbar").html())},onAlign:function(e){this.toggleButton("align",e.currentTarget.dataset.value,e,"stretch")},onChangeGap:function(e){if(this.builder.fields.selectedModel&&!e.currentTarget.disabled){this.builder.fields.selectedModel.set({gap:e.target.value},{silent:!0}),this.builder.syncData();var t=this.builder.fields.selectedModel.get("gap");this.builder.fields.selectedModel.view.$el.css({gap:t?t+"px":""})}},onChangeMinWidth:function(e){if(this.builder.fields.selectedModel&&!e.currentTarget.disabled){this.builder.fields.selectedModel.set({minwidth:e.target.value},{silent:!0}),this.builder.syncData();var t=this.builder.fields.selectedModel.get("minwidth");this.builder.fields.selectedModel.view.$el.css({minWidth:t?t+"px":""})}},onFlex:function(e){this.toggleButton("flex",e.currentTarget.dataset.value,e)},onFlexDirection:function(e){var t=this.builder.fields.selectedModel;t.toggleDirection(),t.view.$el.removeClass(a("direction")),t.view.$el.addClass(a("direction",t.get("direction"))),this.builder.syncData(),this.builder.renderToolbar(),this.builder.metabox.trigger("tippy")},onFlexWrap:function(e){this.toggleButton("wrap",!0,e,!1)},onText:function(e){var t=e.currentTarget.dataset.value;this.toggleButton("text",t,e,t)},onToggleBold:function(e){this.toggleButton("is_bold",!0,e,!1)},onToggleHidden:function(e){this.toggleButton("is_hidden",!0,e,!1)},onToggleItalic:function(e){this.toggleButton("is_italic",!0,e,!1)},onToggleUppercase:function(e){this.toggleButton("is_uppercase",!0,e,!1)},onRemoveField:function(e){this.builder.fields.removeField()},onWrapField:function(e){e.currentTarget.disabled||this.builder.fields.wrapField()},render:function(){if(this.builder.isActive){var e={is_container:!1,is_root:!1,model:{},parent:{}},t=this.builder.fields.selectedModel;t&&(e.is_container=t.isContainer(),e.is_root=0===t.get("level"),e.model=t.toJSON(),t.parent&&(e.parent=t.parent.toJSON())),this.$el.html(this.template(e))}},toggleButton:function(e,t,i,n){var o=this.builder.fields.selectedModel;if(o&&!i.currentTarget.disabled){var r=jQuery(i.currentTarget),l={};l[e]=n||"",r.parent().find("button").removeClass("is-pressed").attr("aria-pressed",!1),t===o.get(e)&&t!==n||(l[e]=t,r.addClass("is-pressed").attr("aria-pressed",!0)),o.set(l,{silent:!0}),o.view.$el.removeClass(a(e)),o.get(e)&&o.view.$el.addClass(a(e,l[e])),this.builder.syncData(),i.currentTarget.blur()}}}),ei=Backbone.View.extend({el:"#glsrt-builder",data:{fields:[],styles:[]},isActive:!1,collection:null,fields:null,metabox:null,toolbar:null,initialize:function(e){_.extend(this,_.pick(e,"metabox")),this.collection=new Ut,this.fields=new qt({builder:this}),this.toolbar=new Zt({builder:this}),this.listenTo(this,"document:click",this.onDocumentClick),this.listenTo(this,"document:keydown",this.onDocumentKeydown),this.listenTo(this,"document:keyup",this.onDocumentKeyup),this.listenTo(this.metabox,"builder:activate",this.activate),this.listenTo(this.metabox,"builder:deactivate",this.deactivate),this.listenTo(this.metabox,"builder:purge",this.purgeCollection)},activate:function(){this.isActive=!0,this.$el.addClass("is-active")},deactivate:function(){this.isActive=!1,this.fields.deselectField(),this.collection.length>1&&this.$el.removeClass("is-active")},onDocumentClick:function(e){this.metabox.el.contains(e.target)||this.metabox.addon.tags.el.contains(e.target)||!document.contains(e.target)||this.deactivate()},onDocumentKeydown:function(e){if(this.fields.selectedModel&&this.fields.selectedModel.parent){var t=this.fields.selectedModel.parent.get("direction");("col"!==t||~["ArrowUp","ArrowDown"].indexOf(e.key))&&("row"!==t||~["ArrowLeft","ArrowRight"].indexOf(e.key))&&(e.key,e.preventDefault(),this.fields.moveField(~["ArrowUp","ArrowLeft"].indexOf(e.key)?"up":"down"))}},onDocumentKeyup:function(e){~["Escape"].indexOf(e.key)?this.pressEscape():~["Tab"].indexOf(e.key)&&!this.fields.el.contains(e.target)?this.pressTab():~["Delete"].indexOf(e.key)&&!e.currentTarget.disabled&&this.pressDelete()},purgeCollection:function(e){var t=this;this.collection.purge(e),this.collection.each((function(e){t.fields.selectedModel&&e.cid===t.fields.selectedModel.cid&&t.metabox.trigger("builder:deselect-field")}))},pressDelete:function(){this.fields.removeField()},pressEscape:function(){this.fields.selectedModel?this.fields.deselectField():this.deactivate()},pressTab:function(){this.fields.selectedModel&&this.fields.deselectField()},removeToolbar:function(){this.toolbar&&(this.toolbar.stopListening(),this.toolbar.$el.html(""))},render:function(){this.syncData(),this.fields.render()},renderToolbar:function(){this.toolbar.render()},syncData:function(){0===this.collection.length&&this.collection.populate(this.data.fields),this.collection.consolidate(),this.collection.sortDesc({silent:!0});for(var e=this.collection.isEmpty()?0:this.collection.max((function(e){return e.get("level")})).get("level"),t=[],i={};e>=0;)_.each(this.collection.where({level:e}),(function(e){var n=e.toJSON();delete n.index,delete n.level,i[e.cid]&&(n.children=i[e.cid]),e.parent?(i[e.parent.cid]||(i[e.parent.cid]=[]),i[e.parent.cid].push(n)):t=[n]})),e--;this.data.fields=t,this.collection.sortAsc({silent:!0}),this.$el.find("[data-builder]").val(JSON.stringify(t))}}),ti=ei,ii=Backbone.View.extend({className:"srt-review-placeholder",template:null,initialize:function(){this.template=_.template(jQuery("#tmpl-glsrt-preview-placeholder").html())},render:function(){return this.$el.html(this.template()),this}}),ni=(Backbone.View.extend({className:"glsrf-review",template:null}),GLSR.addons[l]),oi=Backbone.View.extend({collection:null,el:"#glsrt-preview",display:12,swiper:null,template:null,metabox:null,initialize:function(e){_.extend(this,_.pick(e,"metabox")),this.collection=new Ut,this.template=_.template(jQuery("#tmpl-glsrt-preview").html())},render:function(){var t=this;this.swiper&&(this.swiper.destroy(),this.swiper=null);var i=_.get(this.metabox.settings.getSettings(),["presentation","layout"]);this.$el.html(this.template({has_reviews:this.metabox.reviews.length===this.display,layout:i,swiper:ni.swiper}));var n=this.$el.find(".gl-reviews");return n.html(""),this.collection.reset(),this.collection.populate(this.metabox.builder.data.fields),_.each(_.range(this.display),(function(e,o){var r=t.buildReview(o);r.addClass("glsr-review"),"carousel"===i.display_as&&(r.addClass("gl-slide"),"splide"===ni.swiper&&r.addClass("splide__slide")),n.append(r)})),"carousel"===i.display_as&&("splide"===ni.swiper?(this.swiper=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.gap,n=void 0===i?16:i,o=t.maxslides,r=void 0===o?6:o,a=t.minwidth,s=void 0===a?320:a,d=new Splide(".gl-splide",{arrows:!1,classes:{page:"gl-swiper-bullet",pagination:"gl-swiper-pagination"},flickMaxPages:1,gap:n,noDrag:"a",pagination:!0,perMove:1,perPage:1,snap:!0}),c=u.bind(d,{maxslides:r,minwidth:s});return d.on("drag",(function(){return d.root.classList.add("is-dragging")})),d.on("dragged",(function(){return d.root.classList.remove("is-dragging")})),d.on("resize",c),void 0!==e(GLSR.Event)&&GLSR.Event.on(l+"/swiper/resize",c),d}({gap:+i.spacing,maxslides:+i.max_slides}),this.swiper.mount(),_.debounce((function(){return GLSR.Event.trigger("site-reviews-themes/swiper/resize")}),20)()):(this.swiper=h({breakpoints:p(+i.max_slides),spaceBetween:+i.spacing}),this.swiper.init())),this.metabox.trigger("set-locale-dir"),this},buildReview:function(e){var t=this,i=jQuery(document.createElement("div")),n=_.get(this.metabox.reviews,e);if(n&&this.metabox.builder.collection.length>1)this.collection.each((function(e){var o=new $t({builder:t.metabox.builder,model:e,review:n});o.render(),e.parent?e.parent.view.$el.append(o.el):i.html(o.el)}));else{var o=new ii;i.html(o.render().el)}return i}}),ri=oi,li={boxshadow:function(e){var t=g(e);if(!1===t)return"";var i=_.chain(t).first(4).map((function(e){return e+"px"})).value();return i.push(_.last(t)),i.join(" ")},color:function(e){return e||""},dimensions:function(e){var t=f(e);if(!1===t)return 0;var i=t[4];return _.chain(t).first(4).map((function(e){return e+i})).value().join(" ")},none:function(e){return e},px:function(e){return _.isNaN(+e)?"":e+"px"},unit:function(e){return e||""}},ai=function(e,t,i){if(!_.isEmpty(t.property)&&!_.isArray(t.property)){var n=[t.property],o=[t.validate||"none"],r=[li[o](i)];e.$el.css(_.object(n,r))}},si=function(e){_.each(e.settings.values(),(function(t,i){if(_.isArray(t.theme)){if("ratingcolors"===t.type){var n=m(t.value);_.each(t.theme,(function(t,i){return ai(e,t,n[i])}))}if("typography"===t.type){var o=v(t.value);if(!1===o)return;var r=t.theme[0],l=t.theme[1],a=o[2],s=t.theme[3];ai(e,r,o[0]+a),ai(e,l,o[1]+a),ai(e,s,o[3])}}else _.isObject(t.theme)?ai(e,t.theme,t.value):"rating_image"===i&&e.$el.find("[data-rating]").each((function(e,i){i.setAttribute("data-stars",t.value)})).find("span:not(.screen-reader-text)").each((function(i,n){var o=t.value+"-"+jQuery(n).parent().data("rating"),r=_.get(e.stars,o,_.get(e.stars,t.value));r&&(r=r.replaceAll("gl-gradient",_.uniqueId("gl-")),jQuery(n).html(r))}))}))},di=Backbone.View.extend({el:"#glsrt-metabox-theme",data:{},addon:null,builder:null,navigation:null,preview:null,reviews:null,settings:null,stars:null,initialize:function(e){_.extend(this,_.pick(e,"addon")),this.builder=new ti({metabox:this}),this.navigation=new w({metabox:this}),this.preview=new ri({metabox:this})},refresh:function(){this.builder.render(),this.builder.fields.el.dataset.count=this.builder.collection.length,this.preview.render(),si(this)},render:function(){return this.listenTo(this,"theme:refresh",_.debounce(this.refresh,5)),this.listenTo(this,"toggle:group",this.toggleGroup),this.refresh(),this.navigation.render(),this.listenTo(this.builder.collection,"all",_.debounce(this.refresh,50)),this},toggleGroup:function(e){var t=this;_.each(this.data,(function(e,i){return t.$el.find("#glsrt-"+i).hide()})),"preview"===e&&(this.preview.render(),si(this)),this.$el.find("#glsrt-"+e).show()}}),ci=GLSR.addons["site-reviews-themes"],ui=Backbone.View.extend({el:"#poststuff",tippy:[],settings:null,tags:null,theme:null,initialize:function(){var e=this;if(this.el){try{this.settings=new E({addon:this}),this.tags=new Yt({addon:this}),this.theme=new di({addon:this})}catch(e){var t=_.template('<div style="display:flex;width:100%;align-items:center;"><i class="dashicons-before dashicons-warning" style="color:#d63638; margin-right:.5em;"></i> <%= msg %></div>');return this.$(".loading-content").html(t({msg:ci.error.basic})),this.$("#glsrt-metabox-theme .loading-content").html(t({msg:ci.error.detailed})),void console.error("Review Themes: a plugin or theme is interfering with the admin_footer hook.")}wp.ajax.post(GLSR.action,s("theme")).then((function(t){e.settings.theme=e.theme,e.tags.theme=e.theme,e.theme.settings=e.settings,e.settings.data=t.settings,e.tags.data=t.tags,e.theme.builder.data=t.theme.builder.data,e.theme.data=t.theme,e.theme.reviews=t.reviews,e.theme.stars=t.stars,e.listenTo(e.settings,"colorpicker",e.initColorpickers),e.listenTo(e.theme,"set-locale-dir",e.initTextDirection),e.listenTo(e.settings,"tippy",e.initTippy),e.listenTo(e.tags,"tippy",e.initTippy),e.listenTo(e.theme,"tippy",e.initTippy),e.settings.render(),e.tags.render(),e.theme.render()})).then((function(){jQuery(document).on("click",(function(t){return e.theme.builder.trigger("document:click",t)})),jQuery(document).on("keyup",(function(t){return e.theme.builder.trigger("document:keyup",t)})),jQuery(document).on("keydown",(function(t){e.settings.trigger("document:keydown",t),e.theme.builder.trigger("document:keydown",t)})),e.initColorpickers(),e.initTippy(),e.theme.trigger("sortable")}))}},initTextDirection:function(){this.$(".glsr").each((function(e,t){jQuery(t).addClass("glsr-"+window.getComputedStyle(t,null).getPropertyValue("direction"))}))},initColorpickers:function(){this.$(".glsr-color-picker").wpColorPicker({change:function(e,t){jQuery(e.target).val(t.color.to_s()).trigger("change:colorpicker")},palettes:ci.palettes,width:244}),this.$(".glsr-color-picker").each((function(e,t){var i=jQuery(t).closest(".wp-picker-container");i.addClass("glsr-wp-picker-container"),i.find(".wp-color-result-text").text(jQuery(t).data("text")),i.find(".wp-picker-input-wrap").appendTo(i.find(".wp-picker-holder")),i.find("button").attr("data-tippy-content",t.dataset.tippyContent),i.find("button").attr("data-tippy-allowHTML",!0),i.find(".wp-color-result").on("click",(function(e){var t=jQuery(this).parent().find(".wp-picker-holder");if(t){t.css("left",0);var i=t[0].getBoundingClientRect(),n=Math.ceil(window.innerWidth-i.width-i.left);n<0&&t.css("left",n)}}))}))},initTippy:function(){_.each(this.tippy,(function(e){return e.destroy()})),this.tippy=GLSR.Tippy.tippy(this.el.querySelectorAll("[data-tippy-content]"),{delay:[200,null],plugins:[GLSR.Tippy.plugins.followCursor]})}}),hi=GLSR.addons["site-reviews-themes"];jQuery((function(e){hi.ui=new ui,e("code[data-select-text]").on("click",(function(e){!function(e){if(window.getSelection){var t=window.getSelection(),i=document.createRange();i.selectNodeContents(e),t.removeAllRanges(),t.addRange(i)}}(e.currentTarget)})),function(){var e=document.createElement("div");e.style.display="flex",e.style.flexDirection="column",e.style.rowGap="1px",e.appendChild(document.createElement("div")),e.appendChild(document.createElement("div")),document.body.appendChild(e);var t=1===e.scrollHeight;return e.parentNode.removeChild(e),t}()&&e("html").addClass("gl-flexbox-gap")}))}();