!function(){"use strict";GLSR.addons["site-reviews-filters"];var e,t,r,n=GLSR.Utils.dom,o="glsr.images",i=function(e){var r="is-modal-error is-".concat(e.code,"-error"),o=e.message||"Unable to load the review form.";t.content.innerHTML=n("div",{class:r},o).outerHTML},a=function(e){(r=localStorage.getItem(o))&&localStorage.removeItem(o),localStorage.setItem("glsr.images",JSON.stringify(e))},s=function(e){if(!1===e.errors){var r="#review-"+t.trigger.dataset.id;document.querySelectorAll(r).forEach((function(t,o){var i=n("div");i.innerHTML=e.rendered[o],t.outerHTML=i.querySelector(r).outerHTML})),GLSR.Modal.close("glsr-modal-form")}},l=function(e){var t=(null==e?void 0:e.id)||0;t&&document.querySelectorAll('.glsr-image[data-id="'.concat(t,'"]')).forEach((function(e){var t=e.parentNode;e.remove(),0===t.childElementCount&&t.remove()}))},c=function(e,r,n){var o={};o["".concat(GLSR.nameprefix,"[_action]")]=e;for(var a=0,s=Object.keys(r);a<s.length;a++){var l=s[a];o["".concat(GLSR.nameprefix,"[").concat(l,"]")]=r[l]}t.header.innerHTML="Loading...",t.root.classList.add("is-loading"),GLSR.ajax.post(o,(function(e,o){if(o)return t.root.classList.remove("is-loading"),n(e,r);i(e),console.error({data:r,response:e})}))},d=function(){GLSR.Modal.init("glsr-modal-form",{focus:!0,onClose:function(){r&&localStorage.setItem(o,r),t.content.innerHTML="",t=null,e={},GLSR.forms=GLSR.forms.filter((function(e){return!!e.form.closest("body")})),GLSR.Event.off("site-reviews/form/handle",s),GLSR.Event.trigger("site-reviews/init")},onOpen:function(r){var o,d,v,f,u,g;(function(t){e={},document.querySelectorAll("#review-"+t).forEach((function(t,r){var n,o=JSON.parse(JSON.stringify((null===(n=t.closest(".glsr"))||void 0===n?void 0:n.dataset)||{}));e[r]={};for(var i=0,a=Object.keys(o);i<a.length;i++){var s=a[i];if(~["form","hide","theme"].indexOf(s)){var l=void 0;try{l=JSON.parse(o[s])}catch(e){l=o[s]}Array.isArray(l)&&(l=l.toString()),e[r][s]=l}}}))})((t=r).trigger.dataset.id),function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};c("fetch-review-form",r,(function(o){var s=n("div",{class:o.classes,style:o.style});r.theme&&(s.dataset.theme=r.theme),s.innerHTML=o.content,t.content.innerHTML=s.outerHTML,t.footer.innerHTML=o.footer,t.header.innerHTML=o.header+n("span",{},"ID: ".concat(r.review_id)).outerHTML;var c=t.content.querySelector("form");c?(c.insertAdjacentElement("afterbegin",n("input",{name:"".concat(GLSR.nameprefix,"[attributes]"),type:"hidden",value:JSON.stringify(e)})),a(o.images),GLSR.Event.trigger("site-reviews/init"),setTimeout((function(){t.content.querySelectorAll(".glsr-dropzone").forEach((function(e){e.dropzone.on("deleted-image",l)}))}),50)):(i({code:"unknown"}),console.error({data:r,response:o}))}))}({form:null!==(o=null===(d=t.trigger.closest(".glsr"))||void 0===d||null===(v=d.dataset)||void 0===v?void 0:v.form)&&void 0!==o?o:"",review_id:t.trigger.dataset.id,theme:null!==(f=null===(u=t.trigger.closest(".glsr"))||void 0===u||null===(g=u.dataset)||void 0===g?void 0:g.theme)&&void 0!==f?f:""}),GLSR.Event.on("site-reviews/form/handle",s)}})},v="site-reviews-authors",f=function(){return d()};GLSR.Event.on(v+"/init",f),GLSR.Event.on("site-reviews/modal/open",f),GLSR.Event.on("site-reviews/pagination/handle",f),GLSR.Event.on("site-reviews/init",(function(){GLSR.Event.trigger(v+"/init")}))}();