!function(){"use strict";var e,t={918:function(){var e="site-reviews-images";function t(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var i,n,a=function e(t){var i=Array.isArray(t)?[]:{};for(var n in t){var a=t[n],o={}.toString.call(a).slice(8,-1);i[n]="Array"==o||"Object"==o?e(a):"Date"==o?new Date(a.getTime()):a}return i},o=GLSR.addons[e],r="glsr.images",s={acceptedFiles:o.acceptedfiles,addRemoveLinks:!1,dictCancelUpload:o.text.cancelUpload,dictCancelUploadConfirmation:o.text.cancelUploadConfirmation,dictFallbackMessage:o.text.fallbackMessage,dictFallbackText:o.text.fallbackText,dictFileTooBig:o.text.fileTooBig,dictInvalidFileType:o.text.invalidFileType,dictMaxFilesExceeded:o.text.maxFilesExceeded,dictRemoveFileConfirmation:o.text.removeFileConfirmation,dictResponseError:o.text.responseError,dictUploadCanceled:o.text.uploadCanceled,maxFiles:o.maxfiles,maxFilesize:o.maxfilesize,resizeHeight:1920,resizeMethod:"contain",resizeWidth:1920,thumbnailHeight:300,thumbnailMethod:"contain",thumbnailWidth:300,url:GLSR.ajaxurl},d=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.images=[],this.isDuplicateImage=!1,this.isFormSubmitted=!1,this.dropzone=new Dropzone(t,this.options()),this.dropzone.on("addedfile",this.onAddedFile.bind(this)),this.dropzone.on("addedfile",this.handleEditFile.bind(this)),this.dropzone.on("removedfile",this.onRemovedFile.bind(this)),this.dropzone.on("sending",this.onBeforeSending.bind(this)),this.dropzone.on("success",this.onUploadSuccess.bind(this)),this.dropzone.on("error",this.onError.bind(this)),this.dropzone.on("complete",this.onComplete.bind(this)),this.dropzone.on("queuecomplete",this.onQueueUploadComplete.bind(this)),this.dropzone.on("deleted-image",this.onDeletedImage.bind(this)),this.dropzone.on("deleted-temporary-image",this.onDeletedImage.bind(this)),this.storedEvents={},GLSR.Event.on("site-reviews/form/handle",this.onAfterSubmission.bind(this)),this.populateImages()}var i,n,d;return i=e,n=[{key:"appendToFormData",value:function(e,t,i){return e.append(GLSR.nameprefix+"["+t+"]",i),e}},{key:"deleteImage",value:function(e){var t=this,i=this.normalizeFormData(new FormData);this.appendToFormData(i,"method","delete"),this.appendToFormData(i,"id",e.id),this.toggleButtonState(!0),GLSR.ajax.post(i,(function(e){t.dropzone.emit("deleted-image",e),t.toggleButtonState(!1)}))}},{key:"deleteTemporaryImage",value:function(e){var t=this,i=this.normalizeFormData(new FormData);this.appendToFormData(i,"file",e.file),this.appendToFormData(i,"method","purge"),this.appendToFormData(i,"name",e.name),this.appendToFormData(i,"url",e.dataURL),this.toggleButtonState(!0),GLSR.ajax.post(i,(function(e){t.dropzone.emit("deleted-temporary-image",e),t.toggleButtonState(!1)}))}},{key:"findIndexIn",value:function(e,t){for(var i=0,n=e.length;i<n;i++)if(t.name===e[i].name&&t.size===e[i].size&&t.lastModified===e[i].lastModified)return i;return!1}},{key:"generateThumbnailFromUrl",value:function(e){this.dropzone.emit("thumbnail",e,e.dataURL)}},{key:"handleEditFile",value:function(e){var t=e.previewElement.querySelector("[data-dz-edit]");t&&t.addEventListener("click",this.onEditFile.bind(this,e))}},{key:"insertCaption",value:function(e){var t=e.previewElement.querySelector("[data-dz-caption]");if(t){t.textContent=e.caption;var i=this.findIndexIn(this.images,e);!1!==i&&(this.images[i].caption=e.caption),this.loadImagesInForm(),localStorage.setItem(r,JSON.stringify(this.images))}}},{key:"isDuplicate",value:function(e){var t=a(this.dropzone.files);return t.pop(),!1!==this.findIndexIn(t,e)}},{key:"loadImages",value:function(){for(var e in this.images)if(this.images.hasOwnProperty(e)){var t=this.images[e];this.dropzone.emit("addedfile",t),this.dropzone.createThumbnailFromUrl(t,s.thumbnailWidth,s.thumbnailHeight,s.thumbnailMethod,!0,this.generateThumbnailFromUrl.bind(this,t)),this.dropzone.emit("complete",t),this.dropzone.files.push(t),this.dropzone._callbacks.success[0](t),this.onAddedFile(t)}this.loadImagesInForm()}},{key:"loadImagesInForm",value:function(){var e=[];this.images.forEach((function(t){e.push({caption:t.caption,file:t.file,url:t.dataURL})})),this.dropzone.element.querySelector("[data-dz-images]").value=JSON.stringify(e)}},{key:"normalizeFormData",value:function(e){return e.append("action",GLSR.action),e.append("_ajax_request",!0),this.appendToFormData(e,"_action",o.action),this.appendToFormData(e,"_nonce",o.nonce),e}},{key:"onAddedFile",value:function(e){this.isFormSubmitted=!1,this.isDuplicateImage=this.isDuplicate(e),this.isDuplicateImage&&this.dropzone.removeFile(e)}},{key:"onAfterSubmission",value:function(e){this.isFormSubmitted=!0,!1===e.errors&&this.resetImages()}},{key:"onBeforeSending",value:function(e,t,i){this.normalizeFormData(i),this.appendToFormData(i,"method","upload"),this.toggleButtonState(!0)}},{key:"onComplete",value:function(e){this.insertCaption(e),e.id&&e.previewElement.classList.add("dz-saved")}},{key:"onDeletedImage",value:function(e){e&&(this.removeImage("file",e.file),localStorage.setItem(r,JSON.stringify(this.images)),this.loadImagesInForm())}},{key:"onEditedFile",value:function(e,t){var i=t.querySelector("textarea").value;e.caption=i.replace(/\s+/g," ").trim(),this.insertCaption(e),document.removeEventListener("keydown",this.storedEvents.keydown),GLSR.Modal.close("glsr-modal-caption")}},{key:"onEditFile",value:function(e,t){var i=this,n=document.querySelector("#glsr-dz-caption-tmpl");n&&GLSR.Modal.open("glsr-modal-caption",{focus:!0,onOpen:function(a){a.close.remove(),a.close=null,a.root.classList.add("is-image-caption"),document.body.classList.contains("theme-twentytwentyone")&&a.root.classList.add("site"),n.querySelector("textarea").innerText=e.caption||"",a.content.innerHTML=n.innerHTML,a.content.querySelector(".glsr-dropzone-modal-save").addEventListener("click",(function(){t.preventDefault(),i.onEditedFile(e,a.content)})),document.addEventListener("keydown",i.storedEvents.keydown)}})}},{key:"onError",value:function(e,t){this.dropzone.removeFile(e);var i=document.createElement("div");i.classList.add("glsr-dz-error"),i.innerText=t,this.dropzone.element.appendChild(i),setTimeout((function(){i.parentNode.removeChild(i)}),3e3)}},{key:"onKeydown",value:function(e,t,i){13===i.keyCode&&this.onEditedFile(e,t)}},{key:"onQueueUploadComplete",value:function(){this.toggleButtonState(!1)}},{key:"onRemovedFile",value:function(e){if(!this.isDuplicateImage){if(e.id)this.deleteImage(e);else if(!this.isFormSubmitted)for(var t in this.images)if(this.images.hasOwnProperty(t)&&this.images[t].name===e.name){this.deleteTemporaryImage(this.images[t]);break}this.dropzone.files.length||this.resetImages()}}},{key:"onUploadSuccess",value:function(e,t){if(!e.id){var i={};for(var n in e)~["accepted","height","lastModified","name","processing","size","status","type","width"].indexOf(n)&&(i[n]=e[n]);i.caption="",i.dataURL=t.data.url,i.file=t.data.file,this.images.push(i),this.loadImagesInForm(),localStorage.setItem(r,JSON.stringify(this.images))}}},{key:"options",value:function(){var e=document.querySelector("#glsr-dz-preview-tmpl");return e&&(s.previewTemplate=e.innerHTML),s}},{key:"populateImages",value:function(){this.images=JSON.parse(localStorage.getItem(r))||[],this.images.length>=s.maxFiles&&this.dropzone.element.classList.add("dz-max-files-reached"),this.loadImages()}},{key:"removeImage",value:function(e,t){var i=[],n=0;if(!Array.isArray(this.images))return i;for(var a in this.images)this.images.hasOwnProperty(a)&&this.images[a][e]!==t&&(i[n++]=this.images[a]);this.images=i}},{key:"resetImages",value:function(){var e=this.dropzone.files;for(var t in e)e.hasOwnProperty(t)&&(e[t].id=null,this.dropzone.removeFile(e[t]));localStorage.removeItem(r),this.images=[],this.loadImagesInForm()}},{key:"toggleButtonState",value:function(e){var t=this.dropzone.element.closest("form");if(t){var i=t.querySelector(".glsr-button-text");i&&i.getAttribute("data-text")&&(i.parentNode.disabled=e,i.innerText=e?o.text.pleaseWait:i.getAttribute("data-text"))}}}],n&&t(i.prototype,n),d&&t(i,d),Object.defineProperty(i,"prototype",{writable:!1}),e}(),l=[],c={init:function(e){return document.querySelectorAll(e||".glsr-dropzone").forEach((function(e){if(!e.dropzone)try{l.push(new d(e))}catch(e){console.error(e)}})),l},dropzones:l},u=GLSR.addons[e],p=GLSR.Utils.dom,m=null,h=0,g=function(e){var t=u.swiper.Components.Slides.getAt(u.swiper.index);e&&!n.content.querySelector('.glsr[data-review_id="'.concat(e.review_id,'"]'))&&(n.content.insertAdjacentHTML("beforeend",e.review),n.content.querySelectorAll('p[data-trigger="modal"]').forEach((function(e){e.dataset.trigger="expand"}))),h=t.slide.dataset.index,n.content.querySelectorAll(".glsr[data-review_id]").forEach((function(e){e.dataset.review_id===t.slide.dataset.review_id?(e.style.display="block",GLSR.Event.trigger("site-reviews/excerpts/init",e)):e.style.display="none"}))},f=function(e,t,i){if(0===t){var n=u.swiper.options.speed||0;u.swiper.options={speed:0},u.swiper.add(e.slides,1);var a=e.slides.length;e.has_prev||(u.swiper.remove(0),a--),u.swiper.go(a).options={speed:n}}else u.swiper.length===t+1&&(u.swiper.add(e.slides,t),e.has_next||u.swiper.remove(u.swiper.length-1))},v=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};F(e),k("fetch-image-gallery",e,(function(e){u.storage.data=e.data,n.content.innerHTML=e.html,n.content.querySelectorAll("a.glsri-image").forEach((function(e){return e.addEventListener("click",x)})),""===n.footer.innerHTML&&(n.footer.innerHTML=e.pagination);var t=n.footer.querySelector("input"),i=n.footer.querySelector("button[data-next]"),a=n.footer.querySelector("button[data-prev]");M({input:t,next:i,prev:a,page:e.data.page,max:e.data.max_pages}),n.root.classList.remove("is-loading")}))},y=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};z(e),k("fetch-image-review",e,(function(t){n.content.innerHTML=t.slider,S(t,e,{keyboard:"global",pagination:!1,speed:400}),g(t)}))},S=function(e,t,i){var a=R();n.content.innerHTML=e.slider,u.swiper=new Splide(n.content.querySelector(".splide"),i).mount(),e.has_prev&&e.slides.unshift(a),e.has_next&&e.slides.push(a),u.swiper.add(e.slides),e.images.forEach((function(e,n){e.index!==+t.index||+t.index<1||(u.swiper.options={speed:0},u.swiper.go(n+1).options={speed:i.speed||0})})),u.swiper.on("move",b),u.swiper.on("moved",L)},x=function(e){var t=e.currentTarget;e.preventDefault(),y({ID:t.dataset.id,index:t.dataset.index,review_id:t.dataset.review_id,total:u.storage.data.total})},w=function(e){e.preventDefault();var t=Math.ceil((+h+1)/u.storage.data.per_page)||1;v({page:t})},b=function(e,t,i){var n=u.swiper.Components.Slides,a=n.getAt(e),o=n.getAt(t);if(a.slide.querySelector(".glsri-spinner")){var r=-1;0===e?r=+o.slide.dataset.index-1:n.getLength()===e+1&&(r=+o.slide.dataset.index+1),k("fetch-image-review",{index:r},(function(t){u.swiper.state.is(Splide.STATES.MOVING)?T(t):(f(t,e),g(t))}))}else g()},L=function(e,t,i){var n=u.swiper.Components.Slides,a=n.getAt(e),o=n.getAt(t);a.slide.dataset.review_id!==o.slide.dataset.review_id&&null!==m&&(f(m,i),g(m),T(null))},k=function(e,t,a){for(var o={},r=0,s=Object.keys(i.dataset);r<s.length;r++){var d=s[r];"display"!==d&&(o["".concat(GLSR.nameprefix,"[atts][").concat(d,"]")]=i.dataset[d])}for(var l=0,c=Object.keys(t);l<c.length;l++){var m=c[l];o["".concat(GLSR.nameprefix,"[").concat(m,"]")]=t[m]}o["".concat(GLSR.nameprefix,"[_action]")]=e,n.root.classList.add("is-loading"),GLSR.ajax.post(o,(function(e,i){if(i)return n.root.classList.remove("is-loading"),a(e,t);!function(e){var t="is-modal-error is-".concat(e.code,"-error"),i=e.message||u.text.genericModalError;n.content.innerHTML=p("div",{class:t},i).outerHTML}(e),console.error({data:t,response:e})}))},F=function(e){E("is-image-gallery"),n.content.innerHTML="<div></div>".repeat(12),n.header.innerHTML="<span></span>"+u.text.imageGallery},z=function(e){E("is-image-review"),n.header.innerHTML='<span></span><a href="#" tabindex="0">'+u.text.viewImageGallery+"</a>",n.header.querySelector("a").addEventListener("click",w),u.swiper&&u.swiper.length||(n.content.innerHTML=R()),n.footer.innerHTML="",h=+e.index},T=function(e){m=e},I=function(e,t,i){e.removeEventListener(t,i),e.addEventListener(t,i,!0)},E=function(e){e&&(n.root.className="glsr-modal is-open",n.root.classList.add(e),n.root.classList.add(e)),u.swiper&&u.swiper.destroy(),n.root.setAttribute("style",i.getAttribute("style")),n.content.innerHTML="",n.header.innerHTML=""},M=function(e){var t=e.input,i=e.max,n=e.next,a=e.page,o=e.prev;t.value=a,n.setAttribute("disabled",""),o.setAttribute("disabled",""),n.dataset.page=Math.min(i,a+1),o.dataset.page=Math.max(1,a-1),a>1&&o.removeAttribute("disabled"),a<i&&n.removeAttribute("disabled"),I(n,"click",D.click),I(o,"click",D.click),I(t,"change",D.change)},R=function(){return p("div",{class:"splide__slide"},p("div",{class:"glsri-spinner"},p("div"),p("div"),p("div"))).outerHTML},D={click:function(e){e.preventDefault();var t=+e.currentTarget.dataset.page;v({page:t})},change:GLSR.Utils.debounce((function(e){var t=Math.max(1,Math.min(+e.target.max,+e.target.value));v({page:t})}),400)},O=function(){GLSR.Modal.init("glsr-modal-gallery",{onOpen:function(e){h=0,i=(n=e).trigger.closest(".glsr"),n.trigger.classList.contains("glsri-image")?y({ID:n.trigger.dataset.id,index:n.trigger.dataset.index,review_id:n.trigger.dataset.review_id}):v({page:1})}})},G=GLSR.addons[e],A=GLSR.Utils.dom,C=function(){O(),"modal"===G.modal&&GLSR.Modal.init("glsr-modal-image",{onOpen:function(e){e.content.appendChild(A("figure",A("img",{src:e.trigger.href,height:e.trigger.dataset.height,width:e.trigger.dataset.width}),e.trigger.dataset.caption&&A("figcaption",e.trigger.dataset.caption)))}})};G.Dropzone=c,G.storage={data:{}},GLSR.Event.on(e+"/init",(function(){c.init(),C()})),GLSR.Event.on("site-reviews/modal/open",C),GLSR.Event.on("site-reviews/pagination/handle",C),GLSR.Event.on("site-reviews/pagination/popstate",(function(e){e.state&&e.state["".concat(GLSR.nameprefix,"[_action]")]&&"undefined"!=typeof Spotlight&&Spotlight.close()})),GLSR.Event.on("site-reviews/init",(function(){GLSR.Event.trigger(e+"/init")}))},532:function(){},721:function(){},715:function(){}},i={};function n(e){var a=i[e];if(void 0!==a)return a.exports;var o=i[e]={exports:{}};return t[e](o,o.exports,n),o.exports}n.m=t,e=[],n.O=function(t,i,a,o){if(!i){var r=1/0;for(c=0;c<e.length;c++){i=e[c][0],a=e[c][1],o=e[c][2];for(var s=!0,d=0;d<i.length;d++)(!1&o||r>=o)&&Object.keys(n.O).every((function(e){return n.O[e](i[d])}))?i.splice(d--,1):(s=!1,o<r&&(r=o));if(s){e.splice(c--,1);var l=a();void 0!==l&&(t=l)}}return t}o=o||0;for(var c=e.length;c>0&&e[c-1][2]>o;c--)e[c]=e[c-1];e[c]=[i,a,o]},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e={836:0,513:0,419:0,736:0};n.O.j=function(t){return 0===e[t]};var t=function(t,i){var a,o,r=i[0],s=i[1],d=i[2],l=0;if(r.some((function(t){return 0!==e[t]}))){for(a in s)n.o(s,a)&&(n.m[a]=s[a]);if(d)var c=d(n)}for(t&&t(i);l<r.length;l++)o=r[l],n.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return n.O(c)},i=self.webpackChunk=self.webpackChunk||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))}(),n.O(void 0,[513,419,736],(function(){return n(918)})),n.O(void 0,[513,419,736],(function(){return n(532)})),n.O(void 0,[513,419,736],(function(){return n(721)}));var a=n.O(void 0,[513,419,736],(function(){return n(715)}));a=n.O(a)}();